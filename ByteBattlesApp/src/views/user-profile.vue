<template>
  <div class="user-profile-container">
    <app-navigation></app-navigation>

    <div class="user-profile-wrapper">
      <DangerousHTML
          html="<style>
  .user-profile-container {
    min-height: 100vh;
    background: var(--color-surface);
    padding: var(--spacing-2xl) 0;
  }

  .user-profile-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
      radial-gradient(circle at 40% 60%, color-mix(in srgb, var(--color-primary) 3%, transparent) 0%, transparent 50%),
      repeating-linear-gradient(
        135deg,
        transparent,
        transparent 2px,
        color-mix(in srgb, var(--color-border) 2%, transparent) 2px,
        color-mix(in srgb, var(--color-border) 2%, transparent) 4px
      );
    pointer-events: none;
    z-index: 1;
  }

  .retro-card {
    background: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-level-1);
    position: relative;
  }

  .retro-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
  }

  .vintage-border {
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-md);
    background: var(--color-surface);
    box-shadow:
      inset 0 1px 2px color-mix(in srgb, var(--color-on-surface) 5%, transparent),
      0 2px 4px color-mix(in srgb, var(--color-neutral) 8%, transparent);
  }

  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .profile-section {
    animation: slideInUp 0.6s var(--animation-curve-primary);
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
  </style>"
      ></DangerousHTML>

      <section class="user-profile-section" role="main" aria-label="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç">
        <div class="container">
          <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
          <nav class="breadcrumbs" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
            <ol class="breadcrumbs-list">
              <li class="breadcrumb-item">
                <router-link to="/" class="breadcrumb-link">–ì–ª–∞–≤–Ω–∞—è</router-link>
              </li>
              <li class="breadcrumb-separator">/</li>
              <li class="breadcrumb-item">
                <span class="breadcrumb-current">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span>
              </li>
            </ol>
          </nav>

          <div class="page-header">
            <div class="title-section">
              <h1 class="page-title">
                –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
              </h1>
              <p class="page-subtitle">
                –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º –ø—Ä–æ—Ñ–∏–ª–µ–º, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
              </p>
            </div>
          </div>

          <div class="profile-layout">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <aside class="profile-sidebar" role="complementary" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞–±–∏–Ω–µ—Ç—É">
              <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
              <div class="user-card retro-card">
                <div class="user-header">
                  <div class="avatar-section">
                    <div class="avatar-container">
                      <img
                          :src="userData.avatar"
                          :alt="userData.fullName"
                          class="profile-avatar"
                          v-if="userData.avatar"
                      >
                      <div class="avatar-placeholder" v-else>
                        {{ userData.fullName.charAt(0).toUpperCase() }}
                      </div>
                      <div class="online-status" :class="{ online: userData.isOnline }">
                        {{ userData.isOnline ? '–û–Ω–ª–∞–π–Ω' : '–ù–µ –≤ —Å–µ—Ç–∏' }}
                      </div>
                    </div>
                    <button @click="openAvatarEditor" class="btn-text btn-sm avatar-edit-btn">
                      –°–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ
                    </button>
                  </div>

                  <div class="user-basic-info">
                    <h2 class="user-name">{{ userData.fullName }}</h2>
                    <p class="user-role">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</p>
                    <p class="user-email">{{ userData.email }}</p>

                    <div class="user-stats">
                      <div class="stat">
                        <span class="stat-value">{{ userStats.createdTasks }}</span>
                        <span class="stat-label">—Å–æ–∑–¥–∞–Ω–æ –∑–∞–¥–∞—á</span>
                      </div>
                      <div class="stat">
                        <span class="stat-value">{{ userStats.activeStudents }}</span>
                        <span class="stat-label">—Å—Ç—É–¥–µ–Ω—Ç–æ–≤</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
              <div class="profile-nav retro-card">
                <h3 class="nav-title">
                  –ù–∞–≤–∏–≥–∞—Ü–∏—è
                </h3>
                <nav class="nav-list">
                  <button
                      v-for="item in navItems"
                      :key="item.id"
                      :class="['nav-item', { 'active': activeSection === item.id }]"
                      @click="activeSection = item.id"
                  >

                    <span class="nav-item-text">{{ item.name }}</span>
                    <span class="nav-item-badge" v-if="item.badge">{{ item.badge }}</span>
                  </button>
                </nav>
              </div>

              <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
              <div class="quick-actions retro-card">
                <h3 class="actions-title">
                  –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                </h3>
                <div class="actions-list">
                  <router-link to="/task-template-builder" class="btn-primary full-width">
                    –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                  </router-link>
                  <router-link to="/tasks" class="btn-outline full-width">
                    –ú–æ–∏ –∑–∞–¥–∞—á–∏
                  </router-link>
                </div>
              </div>
            </aside>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
            <main class="profile-main" role="region" :aria-label="`–†–∞–∑–¥–µ–ª: ${getActiveSectionName()}`">
              <!-- –†–∞–∑–¥–µ–ª: –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
              <div v-if="activeSection === 'personal'" class="profile-section">
                <div class="section-header">
                  <h2>
                    –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                  </h2>
                  <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–æ—Ñ–∏–ª—è</p>
                </div>

                <div class="form-grid">
                  <div class="form-section retro-card">
                    <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>

                    <div class="form-group">
                      <label for="full-name" class="required">
                        –ü–æ–ª–Ω–æ–µ –∏–º—è
                      </label>
                      <div class="input-container vintage-border">
                        <input
                            type="text"
                            id="full-name"
                            v-model="userData.fullName"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –ø–æ–ª–Ω–æ–µ –∏–º—è"
                            :class="{ 'error': errors.fullName }"
                        >
                      </div>
                      <div class="error-message" v-if="errors.fullName">{{ errors.fullName }}</div>
                    </div>

                    <div class="form-group">
                      <label for="bio">
                        –û —Å–µ–±–µ
                      </label>
                      <div class="input-container vintage-border">
                        <textarea
                            id="bio"
                            v-model="userData.bio"
                            rows="4"
                            placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ, –≤–∞—à–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö –∏ –æ–ø—ã—Ç–µ..."
                            maxlength="500"
                        ></textarea>
                      </div>
                      <div class="char-counter">{{ userData.bio.length }}/500</div>
                    </div>
                  </div>

                  <div class="form-section retro-card">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

                    <div class="form-group">
                      <label for="email" class="required">
                        Email –∞–¥—Ä–µ—Å
                      </label>
                      <div class="input-container vintage-border">
                        <input
                            type="email"
                            id="email"
                            v-model="userData.email"
                            placeholder="your.email@example.com"
                            :class="{ 'error': errors.email }"
                        >
                      </div>
                      <div class="error-message" v-if="errors.email">{{ errors.email }}</div>
                    </div>



                    <div class="form-group">
                      <label>–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</label>
                      <div class="social-links">
                        <div class="social-input">

                          <input
                              type="url"
                              v-model="userData.linkedInUrl"
                              placeholder="LinkedIn –ø—Ä–æ—Ñ–∏–ª—å"
                              class="vintage-border"
                          >
                        </div>
                        <div class="social-input">
                          <input
                              type="url"
                              v-model="userData.gitHubUrl"
                              placeholder="GitHub –ø—Ä–æ—Ñ–∏–ª—å"
                              class="vintage-border"
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-actions">
                  <button @click="savePersonalInfo" class="btn-primary" :disabled="isSaving">
                    {{ isSaving ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' }}
                  </button>
                  <button @click="resetPersonalInfo" class="btn-outline">
                    –û—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                  </button>
                </div>
              </div>

              <!-- –†–∞–∑–¥–µ–ª: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
              <div v-if="activeSection === 'security'" class="profile-section">
                <div class="section-header">
                  <h2>
                    <span class="section-icon">üîí</span>
                    –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–∞—Ä–æ–ª—å
                  </h2>
                  <p>–û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</p>
                </div>

                <div class="form-grid">
                  <div class="form-section retro-card">
                    <h3>–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>

                    <div class="form-group">
                      <label for="current-password" class="required">
                        –¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å
                      </label>
                      <div class="input-container vintage-border">
                        <input
                            type="password"
                            id="current-password"
                            v-model="passwordData.currentPassword"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å"
                            :class="{ 'error': errors.currentPassword }"
                        >
                        <button
                            @click="togglePasswordVisibility('current')"
                            class="password-toggle"
                            type="button"
                        >
                          <span class="toggle-icon">{{ showPasswords.current ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}</span>
                        </button>
                      </div>
                      <div class="error-message" v-if="errors.currentPassword">{{ errors.currentPassword }}</div>
                    </div>

                    <div class="form-group">
                      <label for="new-password" class="required">
                        –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
                      </label>
                      <div class="input-container vintage-border">
                        <input
                            :type="showPasswords.new ? 'text' : 'password'"
                            id="new-password"
                            v-model="passwordData.newPassword"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"
                            :class="{ 'error': errors.newPassword }"
                        >
                        <button
                            @click="togglePasswordVisibility('new')"
                            class="password-toggle"
                            type="button"
                        >
                          <span class="toggle-icon">{{ showPasswords.new ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}</span>
                        </button>
                      </div>
                      <div class="password-strength" :class="passwordStrength">
                        <div class="strength-bar">
                          <div class="strength-fill" :style="{ width: passwordStrengthPercent + '%' }"></div>
                        </div>
                        <span class="strength-text">{{ passwordStrengthText }}</span>
                      </div>
                      <div class="error-message" v-if="errors.newPassword">{{ errors.newPassword }}</div>
                    </div>

                    <div class="form-group">
                      <label for="confirm-password" class="required">
                        –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
                      </label>
                      <div class="input-container vintage-border">
                        <input
                            :type="showPasswords.confirm ? 'text' : 'password'"
                            id="confirm-password"
                            v-model="passwordData.confirmPassword"
                            placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"
                            :class="{ 'error': errors.confirmPassword }"
                        >
                        <button
                            @click="togglePasswordVisibility('confirm')"
                            class="password-toggle"
                            type="button"
                        >
                          <span class="toggle-icon">{{ showPasswords.confirm ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}</span>
                        </button>
                      </div>
                      <div class="error-message" v-if="errors.confirmPassword">{{ errors.confirmPassword }}</div>
                    </div>

                    <div class="password-requirements">
                      <h4>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é:</h4>
                      <ul>
                        <li :class="{ 'met': passwordData.newPassword.length >= 8 }">
                          –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
                        </li>
                        <li :class="{ 'met': /[A-Z]/.test(passwordData.newPassword) }">
                          –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞
                        </li>
                        <li :class="{ 'met': /[a-z]/.test(passwordData.newPassword) }">
                          –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞
                        </li>
                        <li :class="{ 'met': /[0-9]/.test(passwordData.newPassword) }">
                          –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞
                        </li>
                        <li :class="{ 'met': /[^A-Za-z0-9]/.test(passwordData.newPassword) }">
                          –•–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <div class="form-actions">
                  <button @click="updatePassword" class="btn-primary" :disabled="!canChangePassword || isSaving">
                    <span class="btn-icon">üîí</span>
                    {{ isSaving ? '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...' : '–û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å' }}
                  </button>
                  <button @click="resetPasswordForm" class="btn-outline">
                    <span class="btn-icon">üîÑ</span>
                    –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
                  </button>
                </div>
              </div>



              <!-- –†–∞–∑–¥–µ–ª: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
              <div v-if="activeSection === 'stats'" class="profile-section">
                <div class="section-header">
                  <h2>
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                  </h2>
                  <p>–ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∞—à–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á</p>
                </div>

                <div class="stats-overview">
                  <div class="stats-grid">
                    <div class="stat-card retro-card">
                      <div class="stat-data">
                        <span class="stat-value">{{ userStats.createdTasks }}</span>
                        <span class="stat-label">–°–æ–∑–¥–∞–Ω–æ –∑–∞–¥–∞—á</span>
                      </div>
                    </div>
                    <div class="stat-card retro-card">
                      <div class="stat-data">
                        <span class="stat-value">{{ userStats.solvedTasks }}</span>
                        <span class="stat-label">–†–µ—à–µ–Ω–æ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</span>
                      </div>
                    </div>
                    <div class="stat-card retro-card">
                      <div class="stat-data">
                        <span class="stat-value">{{ userStats.activeStudents }}</span>
                        <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="activity-charts">
                  <div class="chart-section retro-card">
                    <h3>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</h3>
                    <div class="chart-container">
                      <div class="activity-bars">
                        <div
                            v-for="day in activityData"
                            :key="day.date"
                            class="activity-bar"
                            :title="`${day.date}: ${day.tasksCreated} –∑–∞–¥–∞—á —Å–æ–∑–¥–∞–Ω–æ`"
                        >
                          <div
                              class="bar-fill"
                              :style="{ height: day.tasksCreated * 2 + 'px' }"
                              :class="getActivityLevel(day.tasksCreated)"
                          ></div>
                          <span class="bar-label">{{ day.date.split('-')[2] }}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="tasks-breakdown retro-card">
                    <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h3>
                    <div class="breakdown-chart">
                      <div
                          v-for="diff in difficultyBreakdown"
                          :key="diff.level"
                          class="breakdown-item"
                      >
                        <div class="diff-info">
                          <span class="diff-icon">{{ diff.icon }}</span>
                          <span class="diff-label">{{ diff.label }}</span>
                        </div>
                        <div class="diff-stats">
                          <span class="diff-count">{{ diff.count }}</span>
                          <div class="diff-bar">
                            <div
                                class="diff-fill"
                                :style="{ width: diff.percentage + '%' }"
                                :class="diff.level"
                            ></div>
                          </div>
                          <span class="diff-percentage">{{ diff.percentage }}%</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="recent-activity retro-card">
                  <h3>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                  <div class="activity-list">
                    <div
                        v-for="activity in recentActivities"
                        :key="activity.id"
                        class="activity-item"
                    >

                      <div class="activity-content">
                        <p class="activity-text">{{ activity.text }}</p>
                        <span class="activity-time">{{ activity.time }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </main>
          </div>
        </div>
      </section>
    </div>

    <app-footer></app-footer>

    <!-- –†–µ–¥–∞–∫—Ç–æ—Ä –∞–≤–∞—Ç–∞—Ä–∞ -->
    <div v-if="showAvatarEditor" class="dialog-overlay">
      <div class="dialog retro-card">
        <h3 class="dialog-title">–°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞</h3>
        <div class="avatar-editor">
          <div class="avatar-preview">
            <img
                :src="avatarPreview"
                :alt="userData.fullName"
                class="preview-avatar"
                v-if="avatarPreview"
            >
            <div class="avatar-placeholder-large" v-else>
              {{ userData.fullName.charAt(0).toUpperCase() }}
            </div>
          </div>
          <div class="avatar-options">
            <input
                type="file"
                ref="avatarInput"
                @change="handleAvatarUpload"
                accept="image/*"
                hidden
            >
            <button @click="$refs.avatarInput.click()" class="btn-outline full-width">
              <span class="btn-icon">üìÅ</span>
              –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
            </button>
            <button @click="generateAvatar" class="btn-text full-width">
              <span class="btn-icon">üé®</span>
              –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–≤–∞—Ç–∞—Ä
            </button>
            <button @click="removeAvatar" class="btn-text full-width delete-btn">
              <span class="btn-icon">üóëÔ∏è</span>
              –£–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
            </button>
          </div>
        </div>
        <div class="dialog-actions">
          <button @click="showAvatarEditor = false" class="btn-outline">–û—Ç–º–µ–Ω–∞</button>
          <button @click="saveAvatar" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import DangerousHTML from 'dangerous-html/vue'
import AppNavigation from '../components/navigation'
import AppFooter from '../components/footer'
import {userProfilesAPI} from '../api/user'
import {taskAPI} from "@/api/task";

export default {
  name: 'UserProfile',
  components: {
    AppNavigation,
    DangerousHTML,
    AppFooter,
  },
  data() {
    return {
      activeSection: 'personal',
      isSaving: false,
      isLoading: true,
      showAvatarEditor: false,
      showPasswords: {
        current: false,
        new: false,
        confirm: false
      },

      navItems: [
        { id: 'personal', name: '–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', badge: null },
        { id: 'security', name: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', badge: null },
        { id: 'stats', name: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', badge: null }
      ],

      // –î–∞–Ω–Ω—ã–µ –∏–∑ API
      userData: {
        fullName: '',
        email: '',
        phone: '',
        country: '',
        bio: '',
        avatar: '',
        isOnline: false,
        gitHubUrl: '',
        linkedInUrl: ''

      },
      countMedium :0,
      countHard :0,
      countEasy: 0,
      userStats: {
        createdTasks: 0,
        solvedTasks: 0,
        averageRating: 0,
        activeStudents: 0
      },

      passwordData: {
        currentPassword: '',
        newPassword: '',
        confirmPassword: ''
      },

      activityData: [],
      difficultyBreakdown: [],
      recentActivities: [],

      errors: {},
      avatarPreview: null,
      originalUserData: null,
      selectedAvatarFile: null
    }
  },
  computed: {
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ computed —Å–≤–æ–π—Å—Ç–≤–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    passwordStrength() {
      if (!this.passwordData.newPassword) return 'empty'
      const strength = this.calculatePasswordStrength(this.passwordData.newPassword)
      if (strength < 40) return 'weak'
      if (strength < 70) return 'medium'
      return 'strong'
    },

    passwordStrengthPercent() {
      return this.calculatePasswordStrength(this.passwordData.newPassword)
    },

    passwordStrengthText() {
      const texts = {
        empty: '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å',
        weak: '–°–ª–∞–±—ã–π',
        medium: '–°—Ä–µ–¥–Ω–∏–π',
        strong: '–°–∏–ª—å–Ω—ã–π'
      }
      return texts[this.passwordStrength]
    },

    canChangePassword() {
      return this.passwordData.currentPassword &&
          this.passwordData.newPassword &&
          this.passwordData.confirmPassword &&
          this.passwordData.newPassword === this.passwordData.confirmPassword &&
          this.passwordStrength !== 'weak'
    }
  },
  async mounted() {
    await this.loadUserProfile()
  },
  methods: {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    async loadUserProfile() {
      this.isLoading = true
      try {
        const profileData = await userProfilesAPI.getMyProfile()
        this.mapApiDataToUserProfile(profileData)
        this.originalUserData = JSON.parse(JSON.stringify(this.userData))
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error)
        this.$notify({
          type: 'error',
          title: '–û—à–∏–±–∫–∞',
          text: '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è'
        })
      } finally {
        this.isLoading = false
      }
    },


    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API –≤ —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
// –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API –≤ —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    mapApiDataToUserProfile(apiData) {
      console.log('–î–∞–Ω–Ω—ã–µ –∏–∑ API:', apiData)

      // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –ø—Ä–æ—Ñ–∏–ª—è
      this.userData = {
        fullName: apiData.userName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
        email: apiData.email || 'email@example.com',
        phone: apiData.phone || '',
        country: apiData.country || '',
        bio: apiData.bio || '',
        avatar: apiData.avatarUrl || '', // –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: avatarUrl –≤ API
        linkedInUrl: apiData.linkedInUrl || '',
        gitHubUrl: apiData.gitHubUrl || '',
        isOnline: true
      }

      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ API)
      if (apiData.teacherStats) {
        this.userStats = {
          createdTasks: apiData.stats.createdTasks || 0,
          solvedTasks: apiData.stats.totalProblemsSolved || 0, // –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è
          averageRating: 0,
          activeStudents: 0
        }
      } else {
        // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        this.userStats = {
          createdTasks: 24,
          solvedTasks: apiData.stats?.totalProblemsSolved || 1567,
          averageRating: 4.7,
          activeStudents: 89
        }
      }

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
      this.generateMockData()
    },

    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ API
    prepareProfileForApi() {
      return {
        userName: this.userData.fullName,
        bio: this.userData.bio,
        linkedInUrl: this.userData.linkedInUrl,
        gitHubUrl: this.userData.gitHubUrl,
      }
    },

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    async savePersonalInfo() {
      this.validatePersonalInfo()
      if (Object.keys(this.errors).length > 0) return

      this.isSaving = true
      try {
        const updateData = this.prepareProfileForApi()
        await userProfilesAPI.updateMyProfile(updateData)

        this.originalUserData = JSON.parse(JSON.stringify(this.userData))

        this.$notify({
          type: 'success',
          title: '–£—Å–ø–µ—à–Ω–æ',
          text: '–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã'
        })
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error)
        this.$notify({
          type: 'error',
          title: '–û—à–∏–±–∫–∞',
          text: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è'
        })
      } finally {
        this.isSaving = false
      }
    },

    // –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
    async updatePassword() {
      this.validatePassword()
      if (Object.keys(this.errors).length > 0) return

      this.isSaving = true
      try {
        await userProfilesAPI.changePassword({
          oldPassword: this.passwordData.currentPassword,
          newPassword: this.passwordData.newPassword
        })

        this.$notify({
          type: 'success',
          title: '–£—Å–ø–µ—à–Ω–æ',
          text: '–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω'
        })

        this.resetPasswordForm()
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è:', error)
        this.$notify({
          type: 'error',
          title: '–û—à–∏–±–∫–∞',
          text: error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å'
        })
      } finally {
        this.isSaving = false
      }
    },

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
    async saveAvatar() {
      if (!this.selectedAvatarFile && !this.avatarPreview) {
        this.showAvatarEditor = false
        return
      }

      this.isSaving = true
      try {
        if (this.selectedAvatarFile) {
          // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ñ–∞–π–ª - –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ
          await userProfilesAPI.uploadAvatar(this.selectedAvatarFile)
        } else if (this.avatarPreview && this.avatarPreview.startsWith('data:image/svg+xml')) {
          // –ï—Å–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω SVG –∞–≤–∞—Ç–∞—Ä - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Å–æ–±—ã–º –æ–±—Ä–∞–∑–æ–º
          await this.saveGeneratedAvatar()
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
        await this.loadUserProfile()

        this.showAvatarEditor = false
        this.selectedAvatarFile = null

        this.$notify({
          type: 'success',
          title: '–£—Å–ø–µ—à–Ω–æ',
          text: '–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω'
        })
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞:', error)
        this.$notify({
          type: 'error',
          title: '–û—à–∏–±–∫–∞',
          text: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä'
        })
      } finally {
        this.isSaving = false
      }
    },

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –∞–≤–∞—Ç–∞—Ä–∞
    handleAvatarUpload(event) {
      const file = event.target.files[0]
      if (file) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –∏ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
        if (!file.type.startsWith('image/')) {
          this.$notify({
            type: 'error',
            title: '–û—à–∏–±–∫–∞',
            text: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'
          })
          return
        }

        if (file.size > 5 * 1024 * 1024) { // 5MB
          this.$notify({
            type: 'error',
            title: '–û—à–∏–±–∫–∞',
            text: '–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB'
          })
          return
        }

        this.selectedAvatarFile = file

        const reader = new FileReader()
        reader.onload = (e) => {
          this.avatarPreview = e.target.result
        }
        reader.readAsDataURL(file)
      }
    },

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
    async saveGeneratedAvatar() {
      // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º SVG –≤ Blob –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
      const svgContent = atob(this.avatarPreview.split(',')[1])
      const blob = new Blob([svgContent], { type: 'image/svg+xml' })
      const file = new File([blob], 'avatar.svg', { type: 'image/svg+xml' })


    },

    // –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
    async removeAvatar() {
      try {
        // –ï—Å–ª–∏ –µ—Å—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞
        await makeRequest('/api/user-profiles/me/avatar', {
          method: 'DELETE'
        })

        this.avatarPreview = null
        this.selectedAvatarFile = null
        await this.loadUserProfile()
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞:', error)
      }
    },

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    getActivityIcon(activityType) {
      const icons = {
        TASK_CREATED: 'üìù',
        TASK_SOLVED: '‚úÖ',
        REVIEW_RECEIVED: '‚≠ê',
        TASK_UPDATED: 'üîß'
      }
      return icons[activityType] || 'üìå'
    },

    formatTime(timestamp) {
      const now = new Date()
      const activityDate = new Date(timestamp)
      const diffMs = now - activityDate
      const diffMins = Math.floor(diffMs / 60000)
      const diffHours = Math.floor(diffMs / 3600000)
      const diffDays = Math.floor(diffMs / 86400000)

      if (diffMins < 60) {
        return `${diffMins} –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥`
      } else if (diffHours < 24) {
        return `${diffHours} —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥`
      } else {
        return `${diffDays} –¥–Ω–µ–π –Ω–∞–∑–∞–¥`
      }
    },

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    getActiveSectionName() {
      const item = this.navItems.find(item => item.id === this.activeSection)
      return item ? item.name : ''
    },

    openAvatarEditor() {
      this.avatarPreview = this.userData.avatar
      this.showAvatarEditor = true
    },

    generateAvatar() {
      const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7']
      const color = colors[Math.floor(Math.random() * colors.length)]
      const initials = this.userData.fullName.split(' ').map(n => n[0]).join('')

      const svg = `
        <svg width="200" height="200" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <rect width="200" height="200" fill="${color}" rx="100"/>
          <text x="100" y="120" text-anchor="middle" fill="white" font-size="80" font-family="Arial, sans-serif" font-weight="bold">
            ${initials}
          </text>
        </svg>
      `

      this.avatarPreview = 'data:image/svg+xml;base64,' + btoa(svg)
      this.selectedAvatarFile = null
    },

    resetPersonalInfo() {
      this.userData = JSON.parse(JSON.stringify(this.originalUserData))
      this.errors = {}
    },

    validatePersonalInfo() {
      this.errors = {}

      if (!this.userData.fullName?.trim()) {
        this.errors.fullName = '–ü–æ–ª–Ω–æ–µ –∏–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ'
      }

      if (!this.userData.email?.trim()) {
        this.errors.email = 'Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω'
      } else if (!this.isValidEmail(this.userData.email)) {
        this.errors.email = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email'
      }
    },

    validatePassword() {
      this.errors = {}

      if (!this.passwordData.currentPassword) {
        this.errors.currentPassword = '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å'
      }

      if (!this.passwordData.newPassword) {
        this.errors.newPassword = '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å'
      } else if (this.passwordStrength === 'weak') {
        this.errors.newPassword = '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã–π'
      }

      if (!this.passwordData.confirmPassword) {
        this.errors.confirmPassword = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å'
      } else if (this.passwordData.newPassword !== this.passwordData.confirmPassword) {
        this.errors.confirmPassword = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'
      }
    },

    resetPasswordForm() {
      this.passwordData = {
        currentPassword: '',
        newPassword: '',
        confirmPassword: ''
      }
      this.errors = {}
    },

    togglePasswordVisibility(field) {
      this.showPasswords[field] = !this.showPasswords[field]
    },

    calculatePasswordStrength(password) {
      let strength = 0

      if (password.length >= 8) strength += 25
      if (/[A-Z]/.test(password)) strength += 25
      if (/[a-z]/.test(password)) strength += 25
      if (/[0-9]/.test(password)) strength += 15
      if (/[^A-Za-z0-9]/.test(password)) strength += 10

      return Math.min(strength, 100)
    },

    getActivityLevel(count) {
      if (count === 0) return 'none'
      if (count <= 1) return 'low'
      if (count <= 3) return 'medium'
      return 'high'
    },

    isValidEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
      return emailRegex.test(email)
    }
  }
}
</script>

<style scoped>
/* –°—Ç–∏–ª–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ */

.user-profile-container {
  width: 100%;
  display: block;
  min-height: 100vh;
  font-family: var(--font-family-body);
  background: var(--color-surface);
  position: relative;
}

.user-profile-wrapper {
  position: relative;
  z-index: 2;
}

.container {
  max-width: var(--content-max-width);
  margin: 0 auto;
  padding: 0 var(--spacing-lg);
}

/* –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ */
.breadcrumbs {
  margin-bottom: var(--spacing-xl);
}

.breadcrumbs-list {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  list-style: none;
  padding: 0;
  margin: 0;
}

.breadcrumb-link {
  color: var(--color-primary);
  text-decoration: none;
  font-size: var(--font-size-sm);
  transition: color var(--animation-duration-standard) var(--animation-curve-primary);
}

.breadcrumb-link:hover {
  color: var(--color-secondary);
}

.breadcrumb-current {
  color: var(--color-on-surface-secondary);
  font-size: var(--font-size-sm);
}

.breadcrumb-separator {
  color: var(--color-border);
  font-size: var(--font-size-sm);
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
.page-header {
  margin-bottom: var(--spacing-2xl);
}

.title-section {
  text-align: center;
  margin-bottom: var(--spacing-xl);
}

.page-title {
  color: var(--color-on-surface);
  font-size: var(--font-size-hero);
  margin-bottom: var(--spacing-md);
  font-family: var(--font-family-heading);
  font-weight: var(--font-weight-heading);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-md);
  line-height: var(--line-height-heading);
}

.title-icon {
  font-size: var(--font-size-xl);
}

.page-subtitle {
  color: var(--color-on-surface-secondary);
  font-size: var(--font-size-lg);
  margin-bottom: var(--spacing-xl);
  line-height: var(--line-height-body);
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –ª–µ–π–∞—É—Ç */
.profile-layout {
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: var(--spacing-xl);
  align-items: start;
  margin-bottom: var(--spacing-2xl);
}

.profile-sidebar {
  position: sticky;
  top: var(--spacing-xl);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
.user-card {
  padding: var(--spacing-lg);
}

.user-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

.avatar-section {
  margin-bottom: var(--spacing-lg);
}

.avatar-container {
  position: relative;
  margin-bottom: var(--spacing-md);
}

.profile-avatar {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid var(--color-primary);
}

.avatar-placeholder {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: var(--color-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-on-primary);
  font-size: var(--font-size-hero);
  font-weight: var(--font-weight-heading);
  border: 4px solid var(--color-primary);
}

.online-status {
  position: absolute;
  bottom: 8px;
  right: 8px;
  background: var(--color-surface);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--border-radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-heading);
  border: 2px solid var(--color-border);
}

.online-status.online {
  border-color: var(--color-accent);
  color: var(--color-accent);
}

.avatar-edit-btn {
  width: 100%;
}

.user-basic-info {
  width: 100%;
}

.user-name {
  margin: 0 0 var(--spacing-xs) 0;
  font-size: var(--font-size-xl);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
}

.user-role {
  margin: 0 0 var(--spacing-xs) 0;
  color: var(--color-primary);
  font-weight: var(--font-weight-heading);
  font-size: var(--font-size-sm);
}

.user-email {
  margin: 0 0 var(--spacing-lg) 0;
  color: var(--color-on-surface-secondary);
  font-size: var(--font-size-sm);
}

.user-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  background: var(--color-backplate);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--color-border);
}

.stat {
  text-align: center;
}

.stat-value {
  display: block;
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-heading);
  color: var(--color-primary);
  margin-bottom: var(--spacing-xs);
  font-family: var(--font-family-heading);
}

.stat-label {
  font-size: var(--font-size-xs);
  color: var(--color-on-surface-secondary);
  text-transform: lowercase;
}

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
.profile-nav {
  padding: var(--spacing-lg);
}

.nav-title {
  margin: 0 0 var(--spacing-lg) 0;
  font-size: var(--font-size-lg);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.nav-icon {
  font-size: var(--font-size-base);
}

.nav-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.nav-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  border-radius: var(--border-radius-md);
  cursor: pointer;
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
  border: 1px solid transparent;
  background: transparent;
  width: 100%;
  text-align: left;
  position: relative;
}

.nav-item:hover {
  background: var(--color-backplate);
  border-color: var(--color-border);
}

.nav-item.active {
  background: color-mix(in srgb, var(--color-primary) 12%, transparent);
  border-color: var(--color-primary);
  border-left: 4px solid var(--color-primary);
}

.nav-item-icon {
  font-size: var(--font-size-base);
  width: 20px;
  text-align: center;
}

.nav-item-text {
  flex: 1;
  font-weight: var(--font-weight-heading);
  color: var(--color-on-surface);
}

.nav-item-badge {
  background: var(--color-accent);
  color: var(--color-on-surface);
  font-size: var(--font-size-xs);
  padding: 2px 6px;
  border-radius: var(--border-radius-full);
  font-weight: var(--font-weight-heading);
  min-width: 18px;
  text-align: center;
}

/* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */
.quick-actions {
  padding: var(--spacing-lg);
}

.actions-title {
  margin: 0 0 var(--spacing-lg) 0;
  font-size: var(--font-size-lg);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.actions-icon {
  font-size: var(--font-size-base);
}

.actions-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.full-width {
  width: 100%;
}

/* –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
.profile-main {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xl);
}

.section-header {
  margin-bottom: var(--spacing-2xl);
  padding-bottom: var(--spacing-lg);
  border-bottom: 2px solid var(--color-border);
}

.section-header h2 {
  margin: 0 0 var(--spacing-md) 0;
  font-size: var(--font-size-xl);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.section-icon {
  font-size: var(--font-size-lg);
}

.section-header p {
  margin: 0;
  color: var(--color-on-surface-secondary);
  font-size: var(--font-size-base);
  line-height: var(--line-height-body);
}

/* –§–æ—Ä–º—ã */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-xl);
  margin-bottom: var(--spacing-xl);
}

.form-section {
  padding: var(--spacing-lg);
}

.form-section h3 {
  margin: 0 0 var(--spacing-lg) 0;
  font-size: var(--font-size-lg);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
  padding-bottom: var(--spacing-sm);
  border-bottom: 2px solid var(--color-primary);
}

.form-group {
  margin-bottom: var(--spacing-lg);
}

.form-group label {
  display: block;
  margin-bottom: var(--spacing-sm);
  font-weight: var(--font-weight-heading);
  color: var(--color-on-surface);
}

.form-group label.required::after {
  content: " *";
  color: #EF4444;
}

.input-container {
  position: relative;
  padding: var(--spacing-xs);
}

.vintage-border {
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  background: var(--color-surface);
  box-shadow:
      inset 0 1px 2px color-mix(in srgb, var(--color-on-surface) 3%, transparent),
      0 2px 4px color-mix(in srgb, var(--color-neutral) 5%, transparent);
}

.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: var(--spacing-md);
  border: none;
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-base);
  background: transparent;
  color: var(--color-on-surface);
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  outline: none;
}

.form-group textarea {
  resize: vertical;
  min-height: 100px;
}

.form-group input.error,
.form-group textarea.error {
  background: color-mix(in srgb, #EF4444 5%, transparent);
}

.char-counter {
  text-align: right;
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  margin-top: var(--spacing-xs);
}

.error-message {
  color: #EF4444;
  font-size: var(--font-size-sm);
  margin-top: var(--spacing-xs);
  font-weight: var(--font-weight-heading);
}

/* –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ */
.social-links {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.social-input {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.social-icon {
  font-size: var(--font-size-base);
  width: 24px;
  text-align: center;
}

/* –ü–∞—Ä–æ–ª—å */
.password-toggle {
  position: absolute;
  right: var(--spacing-md);
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--color-on-surface-secondary);
  cursor: pointer;
  padding: var(--spacing-xs);
}

.toggle-icon {
  font-size: var(--font-size-base);
}

.password-strength {
  margin-top: var(--spacing-sm);
}

.strength-bar {
  height: 4px;
  background: var(--color-border);
  border-radius: var(--border-radius-full);
  overflow: hidden;
  margin-bottom: var(--spacing-xs);
}

.strength-fill {
  height: 100%;
  border-radius: var(--border-radius-full);
  transition: width var(--animation-duration-slow) var(--animation-curve-primary);
}

.password-strength.empty .strength-fill {
  background: var(--color-border);
  width: 0%;
}

.password-strength.weak .strength-fill {
  background: #EF4444;
  width: 33%;
}

.password-strength.medium .strength-fill {
  background: #F59E0B;
  width: 66%;
}

.password-strength.strong .strength-fill {
  background: #10B981;
  width: 100%;
}

.strength-text {
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
}

.password-requirements {
  margin-top: var(--spacing-lg);
  padding: var(--spacing-md);
  background: var(--color-backplate);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--color-border);
}

.password-requirements h4 {
  margin: 0 0 var(--spacing-sm) 0;
  font-size: var(--font-size-base);
  color: var(--color-on-surface);
}

.password-requirements ul {
  margin: 0;
  padding-left: var(--spacing-lg);
}

.password-requirements li {
  color: var(--color-on-surface-secondary);
  font-size: var(--font-size-sm);
  margin-bottom: var(--spacing-xs);
  transition: color var(--animation-duration-standard) var(--animation-curve-primary);
}

.password-requirements li.met {
  color: #10B981;
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ */
.security-settings {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: var(--spacing-lg);
  padding: var(--spacing-md);
  background: var(--color-backplate);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--color-border);
}

.setting-label {
  flex: 1;
  font-weight: var(--font-weight-heading);
  color: var(--color-on-surface);
  font-size: var(--font-size-base);
}

.setting-control {
  flex-shrink: 0;
}

.setting-description {
  flex-basis: 100%;
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  margin-top: var(--spacing-xs);
  margin-bottom: 0;
}

.security-actions {
  display: flex;
  gap: var(--spacing-sm);
  margin-top: var(--spacing-lg);
}

/* Toggle switch */
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--color-border);
  transition: .4s;
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background: var(--color-surface);
  transition: .4s;
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background: var(--color-primary);
}

input:checked + .toggle-slider:before {
  transform: translateX(26px);
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.notifications-list,
.channels-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
}

.notification-item,
.channel-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  background: var(--color-backplate);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--color-border);
}

.notification-info,
.channel-info {
  flex: 1;
}

.notification-info h4,
.channel-info h4 {
  margin: 0 0 var(--spacing-xs) 0;
  font-size: var(--font-size-base);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
}

.notification-info p,
.channel-info p {
  margin: 0;
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
}

.notification-control,
.channel-control {
  flex-shrink: 0;
}

.frequency-settings {
  margin-top: var(--spacing-lg);
  padding-top: var(--spacing-lg);
  border-top: 1px solid var(--color-border);
}

.frequency-settings h4 {
  margin: 0 0 var(--spacing-md) 0;
  font-size: var(--font-size-base);
  color: var(--color-on-surface);
}

.frequency-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: var(--spacing-sm);
}

.frequency-option {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--spacing-md);
  cursor: pointer;
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
  text-align: center;
}

.frequency-option:hover {
  border-color: var(--color-primary);
}

.frequency-option.selected {
  border-color: var(--color-primary);
  background: color-mix(in srgb, var(--color-primary) 8%, transparent);
}

.freq-icon {
  font-size: var(--font-size-xl);
  margin-bottom: var(--spacing-xs);
}

.freq-label {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-heading);
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.stats-overview {
  margin-bottom: var(--spacing-xl);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-lg);
}

.stat-card {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-lg);
  text-align: left;
}

.stat-card .stat-icon {
  font-size: var(--font-size-xl);
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-surface);
  border-radius: var(--border-radius-md);
}

.stat-card .stat-data {
  display: flex;
  flex-direction: column;
}

.stat-card .stat-value {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-heading);
  color: var(--color-primary);
  margin-bottom: var(--spacing-xs);
  font-family: var(--font-family-heading);
}

.stat-card .stat-label {
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  text-transform: none;
}

.activity-charts {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: var(--spacing-lg);
  margin-bottom: var(--spacing-xl);
}

.chart-section,
.tasks-breakdown {
  padding: var(--spacing-lg);
}

.chart-section h3,
.tasks-breakdown h3 {
  margin: 0 0 var(--spacing-lg) 0;
  font-size: var(--font-size-lg);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
}

.chart-container {
  padding: var(--spacing-md);
}

.activity-bars {
  display: flex;
  align-items: end;
  gap: 2px;
  height: 120px;
  padding: var(--spacing-md) 0;
}

.activity-bar {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  gap: var(--spacing-xs);
}

.bar-fill {
  width: 100%;
  border-radius: 2px 2px 0 0;
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
  min-height: 2px;
}

.bar-fill.none { background: var(--color-border); }
.bar-fill.low { background: color-mix(in srgb, var(--color-primary) 30%, transparent); }
.bar-fill.medium { background: color-mix(in srgb, var(--color-primary) 60%, transparent); }
.bar-fill.high { background: var(--color-primary); }

.bar-label {
  font-size: var(--font-size-xs);
  color: var(--color-on-surface-secondary);
}

.breakdown-chart {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.breakdown-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  background: var(--color-backplate);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--color-border);
}

.diff-info {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.diff-icon {
  font-size: var(--font-size-base);
}

.diff-label {
  font-weight: var(--font-weight-heading);
  color: var(--color-on-surface);
}

.diff-stats {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

.diff-count {
  font-weight: var(--font-weight-heading);
  color: var(--color-on-surface);
  min-width: 20px;
  text-align: center;
}

.diff-bar {
  width: 100px;
  height: 8px;
  background: var(--color-border);
  border-radius: var(--border-radius-full);
  overflow: hidden;
}

.diff-fill {
  height: 100%;
  border-radius: var(--border-radius-full);
  transition: width var(--animation-duration-slow) var(--animation-curve-primary);
}

.diff-fill.easy { background: #10B981; }
.diff-fill.medium { background: #3B82F6; }
.diff-fill.hard { background: #EF4444; }

.diff-percentage {
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  min-width: 30px;
  text-align: right;
}

.recent-activity {
  padding: var(--spacing-lg);
}

.recent-activity h3 {
  margin: 0 0 var(--spacing-lg) 0;
  font-size: var(--font-size-lg);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
}

.activity-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.activity-item {
  display: flex;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  border-radius: var(--border-radius-md);
  background: var(--color-backplate);
  border: 1px solid var(--color-border);
}

.activity-icon {
  font-size: var(--font-size-lg);
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-surface);
  border-radius: var(--border-radius-md);
  flex-shrink: 0;
}

.activity-content {
  flex: 1;
}

.activity-text {
  margin: 0 0 var(--spacing-xs) 0;
  color: var(--color-on-surface);
  font-size: var(--font-size-base);
}

.activity-time {
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
}

/* –î–µ–π—Å—Ç–≤–∏—è —Ñ–æ—Ä–º */
.form-actions {
  display: flex;
  gap: var(--spacing-md);
  justify-content: flex-start;
  padding-top: var(--spacing-lg);
  border-top: 1px solid var(--color-border);
}

/* –î–∏–∞–ª–æ–≥–∏ */
.dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: color-mix(in srgb, var(--color-neutral) 50%, transparent);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: var(--spacing-lg);
}

.dialog {
  padding: var(--spacing-2xl);
  max-width: 500px;
  width: 100%;
}

.dialog-title {
  margin: 0 0 var(--spacing-lg) 0;
  font-size: var(--font-size-xl);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
}

.avatar-editor {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
  margin-bottom: var(--spacing-xl);
}

.avatar-preview {
  display: flex;
  justify-content: center;
}

.preview-avatar {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid var(--color-primary);
}

.avatar-placeholder-large {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  background: var(--color-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-on-primary);
  font-size: var(--font-size-hero);
  font-weight: var(--font-weight-heading);
  border: 4px solid var(--color-primary);
}

.avatar-options {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.dialog-actions {
  display: flex;
  gap: var(--spacing-md);
  justify-content: flex-end;
}

.delete-btn {
  color: #EF4444;
  border-color: #EF4444;
}

.delete-btn:hover:not(:disabled) {
  background: color-mix(in srgb, #EF4444 15%, transparent);
  color: #EF4444;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn-primary,
.btn-outline,
.btn-text,
.btn-sm {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-lg);
  border: 2px solid;
  border-radius: var(--border-radius-md);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-heading);
  text-decoration: none;
  cursor: pointer;
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
  font-family: var(--font-family-body);
}

.btn-primary {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: var(--color-on-primary);
}

.btn-primary:hover:not(:disabled) {
  background: color-mix(in srgb, var(--color-primary) 85%, black);
  border-color: color-mix(in srgb, var(--color-primary) 85%, black);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn-outline {
  background: transparent;
  border-color: var(--color-border);
  color: var(--color-on-surface);
}

.btn-outline:hover:not(:disabled) {
  border-color: var(--color-primary);
  color: var(--color-primary);
}

.btn-text {
  background: transparent;
  border-color: transparent;
  color: var(--color-on-surface);
}

.btn-text:hover:not(:disabled) {
  background: var(--color-backplate);
  color: var(--color-primary);
}

.btn-sm {
  padding: var(--spacing-sm) var(--spacing-md);
  font-size: var(--font-size-sm);
}

.btn-icon {
  font-size: var(--font-size-base);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1200px) {
  .profile-layout {
    grid-template-columns: 280px 1fr;
    gap: var(--spacing-lg);
  }
}

@media (max-width: 1024px) {
  .profile-layout {
    grid-template-columns: 1fr;
  }

  .profile-sidebar {
    position: static;
  }

  .form-grid {
    grid-template-columns: 1fr;
  }

  .activity-charts {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .container {
    padding: 0 var(--spacing-md);
  }

  .page-title {
    font-size: var(--font-size-xl);
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .user-header {
    flex-direction: row;
    text-align: left;
    gap: var(--spacing-lg);
  }

  .avatar-section {
    margin-bottom: 0;
  }

  .user-stats {
    grid-template-columns: repeat(2, 1fr);
  }

  .nav-list {
    flex-direction: row;
    overflow-x: auto;
    padding-bottom: var(--spacing-sm);
  }

  .nav-item {
    flex-shrink: 0;
    min-width: 120px;
  }

  .form-actions {
    flex-direction: column;
  }

  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .activity-bars {
    gap: 1px;
  }

  .dialog-actions {
    flex-direction: column;
  }
}

@media (max-width: 480px) {
  .user-header {
    flex-direction: column;
    text-align: center;
  }

  .stats-grid {
    grid-template-columns: 1fr;
  }

  .setting-item {
    flex-direction: column;
    gap: var(--spacing-md);
    align-items: flex-start;
  }

  .notification-item,
  .channel-item {
    flex-direction: column;
    gap: var(--spacing-md);
    align-items: flex-start;
  }

  .notification-control,
  .channel-control {
    align-self: flex-end;
  }

  .frequency-options {
    grid-template-columns: 1fr;
  }

  .breakdown-item {
    flex-direction: column;
    gap: var(--spacing-md);
    align-items: flex-start;
  }

  .diff-stats {
    width: 100%;
    justify-content: space-between;
  }
}
</style>