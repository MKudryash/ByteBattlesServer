<template>
  <div class="task-template-builder-container10">
    <app-navigation></app-navigation>

    <div class="task-template-builder-container11">
      <div class="task-template-builder-container12">
        <DangerousHTML
            html="<style>
  .builder-container {
    min-height: 100vh;
    background: var(--color-surface);
    padding: var(--spacing-2xl) 0;
  }

  .builder-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
      radial-gradient(circle at 80% 20%, color-mix(in srgb, var(--color-secondary) 6%, transparent) 0%, transparent 50%),
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        color-mix(in srgb, var(--color-border) 5%, transparent) 2px,
        color-mix(in srgb, var(--color-border) 5%, transparent) 4px
      );
    pointer-events: none;
    z-index: 1;
  }

  .wizard-progress {
    position: sticky;
    top: 0;
    background: white;
    z-index: 100;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  .retro-card {
    background: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-level-1);
    position: relative;
  }

  .retro-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
  }

  .vintage-border {
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-md);
    background: var(--color-surface);
    box-shadow:
      inset 0 1px 2px color-mix(in srgb, var(--color-on-surface) 5%, transparent),
      0 2px 4px color-mix(in srgb, var(--color-neutral) 8%, transparent);
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .step-content {
    animation: slideIn 0.5s var(--animation-curve-primary);
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
  </style>"
        ></DangerousHTML>
      </div>
    </div>

    <section class="builder-container" role="main" aria-label="–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —É—á–µ–±–Ω—ã—Ö –∑–∞–¥–∞—á">
      <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å -->
        <div class="builder-header">
          <div class="title-section">
            <h1 class="builder-title">
              –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —É—á–µ–±–Ω—ã—Ö –∑–∞–¥–∞—á
            </h1>
            <p class="builder-subtitle">
              –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –≤ –≤–∏–Ω—Ç–∞–∂–Ω–æ–º —Å—Ç–∏–ª–µ –¥–ª—è –ª—é–±–æ–≥–æ —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
            </p>
          </div>

          <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
          <div class="wizard-progress retro-card">
            <div class="progress-bar">
              <div class="progress-fill" :style="{width: `${(currentStep / steps.length) * 100}%`}"></div>
            </div>
            <div class="steps-indicator">
              <span class="step-counter">–®–∞–≥ {{ currentStep }} –∏–∑ {{ steps.length }}</span>
              <span class="step-name">{{ steps[currentStep - 1]?.name }}</span>
            </div>
          </div>
        </div>

        <div class="wizard-layout">
          <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å —à–∞–≥–∞–º–∏ -->
          <aside class="wizard-sidebar" role="navigation" aria-label="–®–∞–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏">
            <nav class="steps-nav retro-card">
              <div
                  v-for="(step, index) in steps"
                  :key="index"
                  :class="['step-nav-item', {
                  'active': currentStep === index + 1,
                  'completed': currentStep > index + 1
                }]"
                  @click="goToStep(index + 1)"
              >
                <div class="step-nav-icon">
                  <span v-if="currentStep > index + 1">‚úì</span>
                  <span v-else>{{ index + 1 }}</span>
                </div>
                <div class="step-nav-content">
                  <h3>{{ step.name }}</h3>
                  <p>{{ step.description }}</p>
                </div>
              </div>
            </nav>

            <!-- –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
            <div class="quick-preview retro-card">
              <h4>
                <span class="preview-icon">üëÅÔ∏è</span>
                –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
              </h4>
              <div class="preview-badges">
                <span class="preview-badge" v-if="taskData.title">
                  üìå {{ taskData.title }}
                </span>
                <span class="preview-badge" v-if="taskData.language">
                  üíª {{ getLanguageName(taskData.language) }}
                </span>
                <span class="preview-badge" v-if="taskData.functionName">
                  üîß {{ taskData.functionName }}()
                </span>
                <span class="preview-badge" v-if="taskData.tests.length">
                  ‚úÖ {{ taskData.tests.length }} —Ç–µ—Å—Ç{{ taskData.tests.length > 1 ? '–æ–≤' : '' }}
                </span>
                <span class="preview-badge" v-if="taskData.difficulty">
                  üéØ {{ getDifficultyLabel(taskData.difficulty) }}
                </span>
              </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-preview retro-card">
              <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á–∏</h4>
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-value">{{ taskData.parameters.length }}</span>
                  <span class="stat-label">–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value">{{ taskData.libraries.length }}</span>
                  <span class="stat-label">–±–∏–±–ª–∏–æ—Ç–µ–∫</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value">{{ taskData.tests.length }}</span>
                  <span class="stat-label">—Ç–µ—Å—Ç–æ–≤</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value">{{ taskData.examples.length }}</span>
                  <span class="stat-label">–ø—Ä–∏–º–µ—Ä–æ–≤</span>
                </div>
              </div>
            </div>
          </aside>

          <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
          <main class="wizard-main" role="region" :aria-label="`–®–∞–≥ ${currentStep}: ${steps[currentStep - 1]?.name}`">
            <!-- –®–∞–≥ 1: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div v-if="currentStep === 1" class="step-content">
              <div class="step-header">
                <h2>
                  –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞—á–µ
                </h2>
                <p>–î–∞–π—Ç–µ –∑–∞–¥–∞—á–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ, —á—Ç–æ–±—ã —Å—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–Ω–∏–º–∞–ª–∏, —á—Ç–æ –æ—Ç –Ω–∏—Ö —Ç—Ä–µ–±—É–µ—Ç—Å—è</p>
              </div>

              <div class="form-grid">
                <div class="form-section retro-card">
                  <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>

                  <div class="form-group">
                    <label for="task-title" class="required">
                      –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
                    </label>
                    <div class="input-container vintage-border">
                      <input
                          type="text"
                          id="task-title"
                          v-model="taskData.title"
                          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: '–°—É–º–º–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞'"
                          maxlength="100"
                      >
                    </div>
                    <div class="char-counter">{{ taskData.title.length }}/100</div>
                  </div>

                  <div class="form-group">
                    <label for="task-description" class="required">
                      –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
                    </label>
                    <div class="input-container vintage-border">
                      <textarea
                          id="task-description"
                          v-model="taskData.description"
                          rows="6"
                          placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ —É—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏. –ß—Ç–æ –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç? –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤—Ö–æ–¥–µ? –ß—Ç–æ –æ–∂–∏–¥–∞–µ—Ç—Å—è –Ω–∞ –≤—ã—Ö–æ–¥–µ?"
                      ></textarea>
                    </div>
                    <div class="hint">
                      <span class="hint-icon">üí°</span>
                      –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Markdown –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
                    </div>
                  </div>
                </div>

                <div class="form-section retro-card">
                  <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

                  <div class="form-group">
                    <label for="task-category">
                      –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                    </label>
                    <div class="input-container vintage-border">
                      <select id="task-category" v-model="taskData.category">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <option value="algorithms">–ê–ª–≥–æ—Ä–∏—Ç–º—ã</option>
                        <option value="data-structures">–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö</option>
                        <option value="oop">–û–û–ü</option>
                        <option value="web">–í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞</option>
                        <option value="databases">–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="task-difficulty" class="required">
                      –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                    </label>
                    <div class="difficulty-selector">
                      <label
                          v-for="diff in difficultyLevels"
                          :key="diff.value"
                          :class="['difficulty-option vintage-border', { 'selected': taskData.difficulty === diff.value }]"
                      >
                        <input
                            type="radio"
                            v-model="taskData.difficulty"
                            :value="diff.value"
                            hidden
                        >
                        <span class="diff-icon">{{ diff.icon }}</span>
                        <span class="diff-label">{{ diff.label }}</span>
                      </label>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="task-tags">
                      –¢–µ–≥–∏
                    </label>
                    <div class="tags-input vintage-border">
                      <div class="tags-list">
                        <span v-for="(tag, index) in taskData.tags" :key="index" class="tag">
                          {{ tag }}
                          <button @click="removeTag(index)" class="tag-remove">√ó</button>
                        </span>
                      </div>
                      <input
                          type="text"
                          v-model="newTag"
                          @keydown.enter="addTag"
                          placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –∏ –Ω–∞–∂–º–∏—Ç–µ Enter"
                      >
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="time-estimate">
                      –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    </label>
                    <div class="time-estimate vintage-border">
                      <input
                          type="number"
                          id="time-estimate"
                          v-model.number="taskData.timeEstimate"
                          min="5"
                          max="180"
                      >
                      <span>–º–∏–Ω—É—Ç</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- –ü—Ä–∏–º–µ—Ä –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è -->
              <div class="example-section retro-card">
                <h3>–ü—Ä–∏–º–µ—Ä —Ö–æ—Ä–æ—à–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è</h3>
                <div class="example-content">
                  <div class="example-bad">
                    <h4>–ü–ª–æ—Ö–æ:</h4>
                    <p>"–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —á—Ç–æ-—Ç–æ –¥–µ–ª–∞–µ—Ç —Å –º–∞—Å—Å–∏–≤–æ–º"</p>
                  </div>
                  <div class="example-good">
                    <h4>–•–æ—Ä–æ—à–æ:</h4>
                    <p>"–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é <code>findMax</code>, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç. –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç, —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å <code>None</code> (Python) –∏–ª–∏ <code>-1</code> (C++/Java)."</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- –®–∞–≥ 2: –°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏ -->
            <div v-if="currentStep === 2" class="step-content">
              <div class="step-header">
                <h2>
                  –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
                </h2>
                <p>–û–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç. –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã</p>
              </div>


                <div class="form-section retro-card">
                  <h3>–û—Å–Ω–æ–≤–Ω–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞</h3>

                  <div class="form-group">
                    <label for="function-name" class="required">
                      –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏
                    </label>
                    <div class="input-container vintage-border">
                      <input
                          type="text"
                          id="function-name"
                          v-model="taskData.functionName"
                          placeholder="calculateSum, findMax, processData..."
                      >
                    </div>
                  </div>

                  <div class="form-group">
                    <label>
                      –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏
                    </label>
                    <div class="params-container vintage-border">
                      <div class="params-header">
                        <span>–ò–º—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞</span>
                        <span>–¢–∏–ø</span>
                        <span>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</span>
                        <span>–û–ø–∏—Å–∞–Ω–∏–µ</span>
                        <span></span>
                      </div>
                      <div
                          v-for="(param, index) in taskData.parameters"
                          :key="index"
                          class="param-row"
                      >
                        <input
                            type="text"
                            v-model="param.name"
                            placeholder="param1"
                            :class="['vintage-border', { 'error': !param.name && paramSubmitted }]"
                        >
                        <select v-model="param.type" class="vintage-border">
                          <option v-for="type in getAvailableTypes()" :key="type" :value="type">
                            {{ type }}
                          </option>
                        </select>
                        <input
                            type="text"
                            v-model="param.defaultValue"
                            placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"
                            class="vintage-border"
                        >
                        <input
                            type="text"
                            v-model="param.description"
                            placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞"
                            class="vintage-border"
                        >
                        <button
                            @click="removeParameter(index)"
                            class="btn-remove"
                            :disabled="taskData.parameters.length === 1"
                        >
                          √ó
                        </button>
                      </div>
                      <button @click="addParameter" class="btn-outline btn-sm">
                        <span class="btn-icon">+</span>
                        –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä
                      </button>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="return-type">
                      –¢–∏–ø –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
                    </label>
                    <div class="input-container vintage-border">
                      <select id="return-type" v-model="taskData.returnType">
                        <option value="void">void (–Ω–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞)</option>
                        <option v-for="type in getAvailableTypes()" :key="type" :value="type">
                          {{ type }}
                        </option>
                      </select>
                    </div>
                  </div>
                </div>


              <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–∏–≥–Ω–∞—Ç—É—Ä—ã -->
              <div class="preview-section retro-card">
                <h3>
                  –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–∏–≥–Ω–∞—Ç—É—Ä—ã
                </h3>
                <div class="code-preview vintage-border">
                  <pre><code>{{ generateFunctionSignature() }}</code></pre>
                </div>
                <div class="hint">
                  –≠—Ç–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ —à–∞–±–ª–æ–Ω –∫–æ–¥–∞
                </div>
              </div>
            </div>

            <!-- –®–∞–≥ 3: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è -->
            <div v-if="currentStep === 3" class="step-content">
              <div class="step-header">
                <h2>
                  –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
                </h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</p>
              </div>

              <div class="form-grid">
                <div class="form-section retro-card">
                  <h3>–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</h3>

                  <div class="form-group">
                    <label for="language-select" class="required">
                      –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
                    </label>
                    <div class="languages-grid">
                      <label
                          v-for="lang in availableLanguages"
                          :key="lang.id"
                          :class="['language-option vintage-border', { 'selected': taskData.language === lang.id }]"
                      >
                        <input
                            type="radio"
                            v-model="taskData.language"
                            :value="lang.id"
                            hidden
                        >
                        <div class="lang-icon">{{ lang.icon }}</div>
                        <div class="lang-info">
                          <strong>{{ lang.name }}</strong>
                          <span>{{ lang.version }}</span>-
                        </div>
                      </label>
                    </div>
                  </div>

                  <div class="form-group" v-if="taskData.language">
                    <label for="code-template">
                      –®–∞–±–ª–æ–Ω –∫–æ–¥–∞
                    </label>
                    <div class="input-container vintage-border">
                      <textarea
                          id="code-template"
                          v-model="taskData.codeTemplate"
                          rows="8"
                          placeholder="–ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —É–≤–∏–¥—è—Ç —Å—Ç—É–¥–µ–Ω—Ç—ã..."
                      ></textarea>
                    </div>
                    <div class="hint">
                      –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>{{function_signature}}</code> –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤—Å—Ç–∞–≤–∫–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏
                    </div>
                  </div>
                </div>

                <div class="form-section retro-card">
                  <h3>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</h3>

                  <div class="form-group">
                    <label>
                      –î–æ—Å—Ç—É–ø–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
                    </label>
                    <div class="libraries-panel vintage-border">
                      <div class="libraries-search">
                        <input
                            type="text"
                            v-model="librarySearch"
                            placeholder="–ü–æ–∏—Å–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫..."
                            class="vintage-border"
                        >
                      </div>
                      <div class="libraries-list">
                        <div
                            v-for="lib in filteredLibraries"
                            :key="lib.id"
                            :class="['library-item vintage-border', { 'selected': isLibrarySelected(lib.id) }]"
                            @click="toggleLibrary(lib.id)"
                        >
                          <div class="lib-info">
                            <strong>{{ lib.name }}</strong>
                            <span>{{ lib.version }}</span>
                            <p class="lib-description">{{ lib.description }}</p>
                          </div>
                          <div class="lib-compatibility" :class="lib.compatibility">
                            {{ lib.compatibility === 'full' ? '‚úì –°–æ–≤–º–µ—Å—Ç–∏–º–∞' : '‚ö† –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ' }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-group" v-if="taskData.libraries.length > 0">
                    <label>
                      –í—ã–±—Ä–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
                    </label>
                    <div class="selected-libraries">
                      <div
                          v-for="libId in taskData.libraries"
                          :key="libId"
                          class="selected-library vintage-border"
                      >
                        <span>{{ getLibraryName(libId) }}</span>
                        <button @click="toggleLibrary(libId)" class="btn-remove">√ó</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
              <div class="form-section retro-card">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                <div class="execution-settings">
                  <div class="form-group">
                    <label for="time-limit">
                      –õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ (—Å–µ–∫—É–Ω–¥—ã)
                    </label>
                    <div class="input-container vintage-border">
                      <input
                          type="number"
                          id="time-limit"
                          v-model.number="taskData.timeLimit"
                          min="1"
                          max="30"
                      >
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="memory-limit">
                      –õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ (–ú–ë)
                    </label>
                    <div class="input-container vintage-border">
                      <input
                          type="number"
                          id="memory-limit"
                          v-model.number="taskData.memoryLimit"
                          min="16"
                          max="1024"
                      >
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="output-limit">
                      –õ–∏–º–∏—Ç –≤—ã–≤–æ–¥–∞ (–ö–ë)
                    </label>
                    <div class="input-container vintage-border">
                      <input
                          type="number"
                          id="output-limit"
                          v-model.number="taskData.outputLimit"
                          min="1"
                          max="1024"
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- –®–∞–≥ 4: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –ø—Ä–∏–º–µ—Ä—ã -->
            <div v-if="currentStep === 4" class="step-content">
              <div class="step-header">
                <h2>
                  –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                </h2>
                <p>–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ, –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Ñ—É–Ω–∫—Ü–∏—è –∏ –∫–∞–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞–º</p>
              </div>


                <div class="form-section retro-card">
                  <h3>–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)</h3>

                  <div class="form-group">
                    <label for="main-template">
                      <span class="label-icon">üìù</span>
                      –®–∞–±–ª–æ–Ω main —Ñ—É–Ω–∫—Ü–∏–∏
                    </label>
                    <div class="input-container vintage-border">
                      <textarea
                          id="main-template"
                          v-model="taskData.mainTemplate"
                          rows="10"
                          placeholder="–ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã..."
                      ></textarea>
                    </div>
                    <div class="hint">
                      –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>{{function_call}}}</code> –¥–ª—è –≤—ã–∑–æ–≤–∞ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="input-format">
                      –§–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    </label>
                    <div class="input-container vintage-border">
                      <textarea
                          id="input-format"
                          v-model="taskData.inputFormat"
                          rows="3"
                          placeholder="–û–ø–∏—à–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."
                      ></textarea>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="output-format">
                      –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    </label>
                    <div class="input-container vintage-border">
                      <textarea
                          id="output-format"
                          v-model="taskData.outputFormat"
                          rows="3"
                          placeholder="–û–ø–∏—à–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."
                      ></textarea>
                    </div>
                  </div>
                </div>

            </div>

            <!-- –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
            <div v-if="currentStep === 5" class="step-content">
              <div class="step-header">
                <h2>
                  –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                </h2>
                <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ—à–µ–Ω–∏–π —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
              </div>

              <div class="tests-management">
                <div class="tests-header">
                  <h3>–¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏</h3>
                </div>

                <div class="tests-list">
                  <div
                      v-for="(test, index) in taskData.tests"
                      :key="index"
                      :class="['test-case retro-card', { 'public': test.isPublic }]"
                  >
                    <div class="test-header">
                      <div class="test-info">
                        <h4>–¢–µ—Å—Ç {{ index + 1 }}</h4>
                        <div class="test-meta">
              <span class="test-visibility">
                {{ test.isPublic ? '–ü—É–±–ª–∏—á–Ω—ã–π' : '–°–∫—Ä—ã—Ç—ã–π' }}
              </span>
                          <span class="test-weight">–í–µ—Å: {{ test.weight }}</span>
                        </div>
                      </div>
                      <div class="test-actions">
                        <button @click="toggleTestVisibility(index)" class="btn-sm btn-outline">
                          {{ test.isPublic ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å' }}
                        </button>
                        <button @click="removeTest(index)" class="btn-remove">
                          –£–¥–∞–ª–∏—Ç—å
                        </button>
                      </div>
                    </div>

                    <div class="test-content">
                      <div class="test-io">
                        <div class="form-group">
                          <label>–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</label>
                          <div class="input-container vintage-border">
                <textarea
                    v-model="test.input"
                    rows="3"
                    placeholder="–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∞"
                ></textarea>
                          </div>
                        </div>
                        <div class="form-group">
                          <label>–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥</label>
                          <div class="input-container vintage-border">
                <textarea
                    v-model="test.expectedOutput"
                            rows="3"
                            placeholder="–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
                            ></textarea>
                          </div>
                        </div>
                      </div>


                    </div>
                  </div>

                  <button @click="addTest" class="btn-outline_left">
                    <span class="btn-icon">+</span>
                    –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç
                  </button>
                </div>
              </div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="wizard-navigation">
              <div class="nav-left">
                <button
                    v-if="currentStep > 1"
                    @click="previousStep"
                    class="btn-outline_left"
                >
                  <span class="btn-icon">‚Üê</span>
                  –ù–∞–∑–∞–¥
                </button>
              </div>

              <div class="nav-center">
                <div class="step-info">
                  <span class="step-current">{{ currentStep }}</span>
                  <span class="step-separator">/</span>
                  <span class="step-total">{{ steps.length }}</span>
                </div>
              </div>

              <div class="nav-right">
                <button
                    v-if="currentStep < steps.length"
                    @click="validateAndNext"
                    class="btn-primary"
                    :disabled="!canProceed"
                >
                  –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                  <span class="btn-icon">‚Üí</span>
                </button>
                <button
                    v-else
                    @click="saveTask"
                    class="btn-accent"
                    :disabled="!canSave || isSaving"
                >
                  <span class="btn-icon">üíæ</span>
                  {{ isSaving ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞—á—É' }}
                </button>

                <button @click="saveDraft" class="btn-text">
                  <span class="btn-icon">üìÑ</span>
                  –ß–µ—Ä–Ω–æ–≤–∏–∫
                </button>
              </div>
            </div>
          </main>
        </div>
      </div>
    </section>

    <app-footer></app-footer>
  </div>
</template>

<script>
import DangerousHTML from 'dangerous-html/vue'
import AppNavigation from '../components/navigation'
import AppFooter from '../components/footer'
import { languageAPI, taskAPI } from '../api/task.js'
export default {
  name: 'TaskTemplateBuilder',
  components: {
    AppNavigation,
    DangerousHTML,
    AppFooter,
  },
  data() {
    return {
      currentStep: 1,
      paramSubmitted: false,
      librarySearch: '',
      isLoadingLibraries: false,
      newTag: '',
      isSaving: false,
      isLoading: false, // –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ
      error: null, // –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ
      steps: [
        { name: '–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', description: '–ù–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏' },
        { name: '–°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏', description: '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤' },
        { name: '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è', description: '–Ø–∑—ã–∫, –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ' },
        { name: '–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è', description: '–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –ø—Ä–∏–º–µ—Ä—ã' },
        { name: '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', description: '–¢–µ—Å—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏–π' }
      ],
      taskData: {
        title: '',
        description: '',
        category: '',
        difficulty: 'medium',
        tags: [],
        timeEstimate: 30,

        functionName: '',
        parameters: [{ name: '', type: 'int', defaultValue: '', description: '' }],
        returnType: 'void',
        functionDescription: '',
        preConditions: [],
        postConditions: [],
        timeComplexity: '',

        language: '',
        codeTemplate: '',
        libraries: [],
        timeLimit: 10,
        memoryLimit: 256,
        outputLimit: 64,

        mainTemplate: '',
        inputFormat: '',
        outputFormat: '',
        examples: [{
          description: '',
          input: '',
          output: '',
          isPublic: true
        }],

        tests: [{
          input: '',
          expectedOutput: '', // –ò–∑–º–µ–Ω–∏–ª–∏ —Å output –Ω–∞ expectedOutput
          isPublic: true,
          weight: 5,
          checkType: 'exact',
          customCheck: ''
        }],

        autoGrade: true,
        showDetailedErrors: false,
        allowCustomTests: false
      },
      difficultyLevels: [
        { value: 'easy', label: '–ù–∞—á–∏–Ω–∞—é—â–∏–π', icon: 'üå±' },
        { value: 'medium', label: '–°—Ä–µ–¥–Ω–∏–π', icon: 'üéØ' },
        { value: 'hard', label: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π', icon: 'üöÄ' },
        { value: 'expert', label: '–≠–∫—Å–ø–µ—Ä—Ç', icon: 'üèÜ' }
      ],
      availableLanguages: [],
      availableLibraries: [
        { id: 'numpy', name: 'NumPy', version: '1.23.0', description: '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –Ω–∞—É—á–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π', compatibility: 'full' },
        { id: 'pandas', name: 'Pandas', version: '1.5.3', description: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö', compatibility: 'full' },
        { id: 'matplotlib', name: 'Matplotlib', version: '3.7.1', description: '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏', compatibility: 'full' },
        { id: 'requests', name: 'Requests', version: '2.28.2', description: 'HTTP –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Python', compatibility: 'full' },
        { id: 'junit', name: 'JUnit', version: '5.9.0', description: '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', compatibility: 'full' },
        { id: 'mockito', name: 'Mockito', version: '4.11.0', description: '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è', compatibility: 'limited' },
        { id: 'boost', name: 'Boost', version: '1.80.0', description: '–ù–∞–±–æ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫ –¥–ª—è C++', compatibility: 'full' },
        { id: 'catch2', name: 'Catch2', version: '3.3.0', description: '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è C++', compatibility: 'full' }
      ]
    }
  },
  async mounted() {
  await this.loadLanguages()
  },
  computed: {
    canProceed() {
      switch (this.currentStep) {
        case 1:
          return this.taskData.title.trim() && this.taskData.description.trim()
        case 2:
          return this.taskData.functionName.trim() &&
              this.taskData.parameters.every(p => p.name.trim())
        case 3:
          return this.taskData.language
        case 4:
          return this.taskData.mainTemplate.trim()
        default:
          return true
      }
    },
    canSave() {
      // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤
      const hasValidTests = this.taskData.tests.some(test =>
          test.input.trim() && test.expectedOutput.trim() // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–º—è –ø–æ–ª—è
      );

      return this.canProceed && hasValidTests;
    },
    filteredLibraries() {
      if (!this.librarySearch) return this.availableLibraries
      return this.availableLibraries.filter(lib =>
          lib.name.toLowerCase().includes(this.librarySearch.toLowerCase()) ||
          lib.description.toLowerCase().includes(this.librarySearch.toLowerCase())
      )
    }
  },
  methods: {
    async loadLanguages() {
      this.isLoading = true
      this.error = null

      try {
        const languages = await languageAPI.getAll()

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
        this.availableLanguages = languages.map(lang => ({
          id: lang.id,
          name: lang.title || 'Unknown Language',
          shortName: lang.shortTitle || lang.title?.substring(0, 3).toUpperCase() || 'UNK',
          version: lang.version || '1.0',
          fileExtension: lang.fileExtension || '.txt',
          compilerCommand: lang.compilerCommand,
          executionCommand: lang.executionCommand,
          supportsCompilation: lang.supportsCompilation || false,
          patternMain: lang.patternMain,
          patternFunction: lang.patternFunction,
          icon: this.getLanguageIcon(lang.title || lang.shortTitle || lang.id),
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ API
          libraries: lang.libraries ? lang.libraries.map(lib => ({
            id: lib.id,
            name: lib.name || 'Unknown Library',
            version: lib.version || '1.0.0',
            description: lib.description || 'No description available',
            languageId: lib.languageId,
            compatibility: 'full'
          })) : []
        }))

        console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${this.availableLanguages.length} —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è`)
        // –õ–æ–≥–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        this.availableLanguages.forEach(lang => {
          console.log(`–Ø–∑—ã–∫ ${lang.name}: ${lang.libraries.length} –±–∏–±–ª–∏–æ—Ç–µ–∫`, lang.libraries)
        })

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —è–∑—ã–∫–æ–≤:', error)
        this.error = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —è–∑—ã–∫–æ–≤'

        if (error.message.includes('401') || error.message.includes('403')) {
          this.error = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞.'
        } else if (error.message.includes('Network Error')) {
          this.error = '–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —Å–µ—Ä–≤–µ—Ä—É'
        }
      } finally {
        this.isLoading = false
      }
    },
    async loadLibrariesForLanguage(languageId) {
      if (!languageId) {
        this.availableLibraries = [];
        return;
      }

      this.isLoadingLibraries = true;
      try {
        console.log('Loading libraries for language:', languageId);


        const selectedLanguage = this.availableLanguages.find(lang => lang.id === languageId);

        if (selectedLanguage && selectedLanguage.libraries && selectedLanguage.libraries.length > 0) {
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
          this.availableLibraries = selectedLanguage.libraries;
          console.log(`Loaded ${this.availableLibraries.length} libraries from cached data`);
        } else {
          console.log('Using default libraries for language:', languageId);
        }

      } catch (error) {
        console.error('Error loading libraries:', error);
      } finally {
        this.isLoadingLibraries = false;
      }
    },
    getLanguageIcon(languageName) {
      const iconMap = {
        'python': 'üêç',
        'java': '‚òï',
        'javascript': 'üìú',
        'typescript': 'üî∑',
        'cpp': '‚ö°',
        'csharp': 'üéµ',
        'go': 'üêπ',
        'rust': 'ü¶Ä',
        'ruby': 'üíé',
        'php': 'üêò',
        'swift': 'üê¶',
        'kotlin': 'üî∂'
      }

      const lowerName = languageName.toLowerCase()
      return iconMap[lowerName] || 'üíª'
    },
    goToStep(step) {
      if (step <= this.currentStep) {
        this.currentStep = step
      }
    },

    nextStep() {
      if (this.currentStep < this.steps.length) {
        this.currentStep++
      }
    },

    previousStep() {
      if (this.currentStep > 1) {
        this.currentStep--
      }
    },

    validateAndNext() {
      this.paramSubmitted = true
      if (this.canProceed) {
        this.nextStep()
      }
    },

    addParameter() {
      this.taskData.parameters.push({
        name: '',
        type: 'int',
        defaultValue: '',
        description: ''
      })
    },

    removeParameter(index) {
      if (this.taskData.parameters.length > 1) {
        this.taskData.parameters.splice(index, 1)
      }
    },

    addTag() {
      if (this.newTag.trim() && !this.taskData.tags.includes(this.newTag.trim())) {
        this.taskData.tags.push(this.newTag.trim())
        this.newTag = ''
      }
    },

    removeTag(index) {
      this.taskData.tags.splice(index, 1)
    },

    toggleLibrary(libId) {
      const index = this.taskData.libraries.indexOf(libId)
      if (index > -1) {
        this.taskData.libraries.splice(index, 1)
      } else {
        this.taskData.libraries.push(libId)
      }
    },

    isLibrarySelected(libId) {
      return this.taskData.libraries.includes(libId)
    },

    getLibraryName(libId) {
      const lib = this.availableLibraries.find(l => l.id === libId)
      return lib ? lib.name : libId
    },


    addTest() {
      this.taskData.tests.push({
        input: '',
        expectedOutput: '',
        isPublic: false,
        weight: 5,
        checkType: 'exact',
        customCheck: ''
      })
    },

    removeTest(index) {
      if (this.taskData.tests.length > 1) {
        this.taskData.tests.splice(index, 1)
      }
    },

    toggleTestVisibility(index) {
      this.taskData.tests[index].isPublic = !this.taskData.tests[index].isPublic
    },


    getAvailableTypes() {
      const baseTypes = ['int', 'float', 'double', 'string', 'boolean', 'char', 'byte']
      const collectionTypes = ['array', 'list', 'vector', 'map', 'dictionary', 'set']

      if (this.taskData.language === 'python') {
        return [...baseTypes, 'list', 'dict', 'tuple', 'set', 'None']
      } else if (this.taskData.language === 'java') {
        return [...baseTypes, 'List', 'ArrayList', 'Map', 'HashMap', 'Set', 'HashSet']
      } else if (this.taskData.language === 'cpp') {
        return [...baseTypes, 'vector', 'array', 'map', 'set', 'string']
      }

      return [...baseTypes, ...collectionTypes]
    },

    generateFunctionSignature() {
      if (!this.taskData.functionName) return '// –í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏'

      const params = this.taskData.parameters
          .filter(p => p.name)
          .map(p => {
            let paramStr = p.name
            if (p.type) paramStr += `: ${p.type}`
            if (p.defaultValue) paramStr += ` = ${p.defaultValue}`
            return paramStr
          })
          .join(', ')

      let signature = `${this.taskData.functionName}(${params})`

      if (this.taskData.returnType !== 'void') {
        signature += ` -> ${this.taskData.returnType}`
      }

      return signature
    },

    getLanguageName(langId) {
      const lang = this.availableLanguages.find(l => l.id === langId)
      return lang ? lang.name : langId
    },

    getDifficultyLabel(difficulty) {
      const diff = this.difficultyLevels.find(d => d.value === difficulty)
      return diff ? diff.label : difficulty
    },

    saveDraft() {
      console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞:', this.taskData)
      alert('–ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!')
    },
    saveTask() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–∞–ª–∏–¥–Ω—ã–µ —Ç–µ—Å—Ç—ã
      const hasValidTests = this.taskData.tests.some(test =>
          test.input.trim() && test.expectedOutput.trim()
      );

      if (!hasValidTests) {
        alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–µ—Å—Ç —Å –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –æ–∂–∏–¥–∞–µ–º—ã–º –≤—ã–≤–æ–¥–æ–º');
        return;
      }

      // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è)
      const currentUser = this.getCurrentUser();

      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–µ API
      const taskToSave = {
        title: this.taskData.title,
        description: this.taskData.description,
        difficulty: this.taskData.difficulty,
        author: currentUser,
        functionName: this.taskData.functionName,
        patternMain: this.taskData.mainTemplate,
        patternFunction: this.taskData.codeTemplate,
        languageId: this.formatLanguageIds()
      };

      console.log('–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', taskToSave);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      this.sendTaskToServer(taskToSave);
    },

// –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    getCurrentUser() {
      // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      // –ù–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ Vuex store, localStorage, –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –º–µ—Å—Ç–∞
      return localStorage.getItem('currentUser') || 'default_user';
    },

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    formatInputParameters() {
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Å—Ç—Ä–æ–∫—É
      return this.taskData.parameters
          .filter(param => param.name.trim()) // –¢–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
          .map(param => {
            let paramStr = `${param.name}: ${param.type}`;
            if (param.defaultValue) {
              paramStr += ` = ${param.defaultValue}`;
            }
            if (param.description) {
              paramStr += ` // ${param.description}`;
            }
            return paramStr;
          })
          .join(', ');
    },

    formatLanguageIds() {
      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ –≤ –º–∞—Å—Å–∏–≤ UUID
      // –ï—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —è–∑—ã–∫, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ —Å –æ–¥–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º
      return this.taskData.language ? [this.taskData.language] : [];
    },

// –ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    // –ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    async sendTaskToServer(taskData) {
      try {
        this.isSaving = true;

        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...', taskData);
        const response = await taskAPI.create(taskData);

        console.log('–ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞:', response);

        // –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏
        if (response && response.id) {
          console.log('ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏:', response.id);
          await this.saveTestCases(response.id);
        } else {
          console.error('–ù–µ –ø–æ–ª—É—á–µ–Ω ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏');
          alert('–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤');
          this.isSaving = false;
        }

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏:', error);

        // –ë–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        let errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏';
        if (error.response && error.response.data) {
          const errorData = error.response.data;
          errorMessage += `: ${errorData.title || errorData.detail || JSON.stringify(errorData)}`;
        } else {
          errorMessage += `: ${error.message}`;
        }

        alert(errorMessage);
        this.isSaving = false;
      }
    },

    async saveTestCases(taskId) {
      try {
        const testCasesDto = {
          testCases: this.taskData.tests
              .filter(test => test.input.trim() && test.expectedOutput.trim())
              .map(test => ({
                input: test.input.trim(),
                output: test.expectedOutput.trim(),
                isPublic: test.isPublic || false
              }))
        };

        console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤:', testCasesDto);

        if (testCasesDto.testCases.length > 0) {
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º DTO –æ–±—ä–µ–∫—Ç, –∞ –Ω–µ –º–∞—Å—Å–∏–≤ –Ω–∞–ø—Ä—è–º—É—é
          await taskAPI.createTestCases(taskId, testCasesDto);
          console.log('–¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
          alert('–ó–∞–¥–∞—á–∞ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!');

          // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–¥–∞—á
          this.$router.push('/tasks');
        } else {
          alert('–ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! (–±–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤)');
          this.$router.push('/tasks');
        }

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤:', error);

        let errorMessage = '–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏';

        if (error.response && error.response.data) {
          const errorData = error.response.data;
          errorMessage += `: ${errorData.title || errorData.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'}`;
          console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', errorData);
        } else {
          errorMessage += `: ${error.message}`;
        }

        alert(errorMessage);
        this.$router.push('/tasks');
      } finally {
        this.isSaving = false;
      }
    },
    generateLanguageSpecificSignature() {
      if (!this.taskData.functionName || !this.taskData.language) return '';

      const language = this.availableLanguages.find(lang => lang.id === this.taskData.language);
      if (!language) return '';

      const params = this.taskData.parameters
          .filter(p => p.name.trim())
          .map(p => {
            const paramName = p.name.trim();
            let paramStr = paramName;

            if (p.type && this.supportsTypeAnnotations(this.taskData.language)) {
              paramStr = this.formatParameterWithType(paramName, p.type, this.taskData.language);
            }

            if (p.defaultValue && p.defaultValue.trim()) {
              paramStr += this.formatDefaultValue(p.defaultValue, this.taskData.language);
            }

            return paramStr;
          })
          .join(', ');

      const functionName = this.taskData.functionName.trim();
      const returnType = this.taskData.returnType;

      return this.formatFunctionSignature(functionName, params, returnType, this.taskData.language);
    },

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ç–∏–ø–æ–≤ –¥–ª—è —è–∑—ã–∫–∞
    supportsTypeAnnotations(languageId) {
      const typedLanguages = ['java', 'cpp', 'csharp', 'typescript'];
      const language = this.availableLanguages.find(lang => lang.id === languageId);
      return typedLanguages.includes(language?.shortName?.toLowerCase()) || false;
    },

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Å —Ç–∏–ø–æ–º
    formatParameterWithType(paramName, paramType, languageId) {
      const language = this.availableLanguages.find(lang => lang.id === languageId);
      const langShortName = language?.shortName?.toLowerCase();

      switch (langShortName) {
        case 'python':
          return `${paramName}: ${this.mapTypeToLanguage(paramType, languageId)}`;
        case 'java':
        case 'cpp':
        case 'csharp':
          return `${this.mapTypeToLanguage(paramType, languageId)} ${paramName}`;
        default:
          return paramName;
      }
    },

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    formatDefaultValue(defaultValue, languageId) {
      const language = this.availableLanguages.find(lang => lang.id === languageId);
      const langShortName = language?.shortName?.toLowerCase();

      switch (langShortName) {
        case 'python':
          return ` = ${defaultValue}`;
        case 'cpp':
        case 'csharp':
        case 'java':
          return ` = ${defaultValue}`;
        default:
          return ` = ${defaultValue}`;
      }
    },

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏
    formatFunctionSignature(functionName, params, returnType, languageId) {
      const language = this.availableLanguages.find(lang => lang.id === languageId);
      const langShortName = language?.shortName?.toLowerCase();

      let signature = `${functionName}(${params})`;

      // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø
      if (returnType && returnType !== 'void') {
        switch (langShortName) {
          case 'python':
            signature += ` -> ${this.mapTypeToLanguage(returnType, languageId)}`;
            break;
          case 'java':
          case 'cpp':
          case 'csharp':
            signature = `${this.mapTypeToLanguage(returnType, languageId)} ${signature}`;
            break;
        }
      } else if (returnType === 'void' && langShortName !== 'python') {
        signature = `void ${signature}`;
      }

      return signature;
    },

    // –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —è–∑—ã–∫
    mapTypeToLanguage(type, languageId) {
      const language = this.availableLanguages.find(lang => lang.id === languageId);
      const langShortName = language?.shortName?.toLowerCase();

      const typeMap = {
        python: {
          'int': 'int',
          'float': 'float',
          'double': 'float',
          'string': 'str',
          'boolean': 'bool',
          'char': 'str',
          'byte': 'bytes',
          'array': 'list',
          'list': 'list',
          'vector': 'list',
          'map': 'dict',
          'dictionary': 'dict',
          'set': 'set',
          'void': 'None'
        },
        java: {
          'int': 'int',
          'float': 'float',
          'double': 'double',
          'string': 'String',
          'boolean': 'boolean',
          'char': 'char',
          'byte': 'byte',
          'array': 'array',
          'list': 'List',
          'vector': 'Vector',
          'map': 'Map',
          'dictionary': 'Dictionary',
          'set': 'Set',
          'void': 'void'
        },
        cpp: {
          'int': 'int',
          'float': 'float',
          'double': 'double',
          'string': 'std::string',
          'boolean': 'bool',
          'char': 'char',
          'byte': 'unsigned char',
          'array': 'std::array',
          'list': 'std::list',
          'vector': 'std::vector',
          'map': 'std::map',
          'dictionary': 'std::map',
          'set': 'std::set',
          'void': 'void'
        },
        csharp: {
          'int': 'int',
          'float': 'float',
          'double': 'double',
          'string': 'string',
          'boolean': 'bool',
          'char': 'char',
          'byte': 'byte',
          'array': 'array',
          'list': 'List',
          'vector': 'List',
          'map': 'Dictionary',
          'dictionary': 'Dictionary',
          'set': 'HashSet',
          'void': 'void'
        }
      };

      const langMap = typeMap[langShortName] || typeMap.python;
      return langMap[type] || type;
    },

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–∞ main —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞
    generateMainTemplate() {
      if (!this.taskData.language) return '';

      const language = this.availableLanguages.find(lang => lang.id === this.taskData.language);
      if (!language || !language.patternMain) return '';

      // –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –≤ —à–∞–±–ª–æ–Ω–µ main
      let mainTemplate = language.patternMain;

      // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏, –µ—Å–ª–∏ –µ—Å—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä–∞
      if (this.taskData.functionName) {
        const functionCall = this.generateFunctionCall();
        mainTemplate = mainTemplate.replace('/* –∫–æ–¥ */', functionCall + '\n    /* –≤–∞—à –∫–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */');
      }

      return mainTemplate;
    },

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏
    generateFunctionCall() {
      if (!this.taskData.functionName) return '';

      const params = this.taskData.parameters
          .filter(p => p.name.trim())
          .map(p => {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            return this.generateExampleValue(p.type, p.name);
          })
          .join(', ');

      const functionName = this.taskData.functionName.trim();

      // –î–ª—è —è–∑—ã–∫–æ–≤, –≥–¥–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      if (this.taskData.returnType && this.taskData.returnType !== 'void') {
        const language = this.availableLanguages.find(lang => lang.id === this.taskData.language);
        const langShortName = language?.shortName?.toLowerCase();

        let resultType = this.mapTypeToLanguage(this.taskData.returnType, this.taskData.language);
        let resultVar = 'result';

        switch (langShortName) {
          case 'python':
            return `${resultVar} = ${functionName}(${params})`;
          case 'java':
          case 'cpp':
          case 'csharp':
            return `${resultType} ${resultVar} = ${functionName}(${params});`;
          default:
            return `${functionName}(${params});`;
        }
      } else {
        return `${functionName}(${params});`;
      }
    },

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    generateExampleValue(type, paramName) {
      const examples = {
        'int': '42',
        'float': '3.14',
        'double': '3.14',
        'string': `"${paramName}"`,
        'boolean': 'true',
        'char': `'a'`,
        'array': `[1, 2, 3]`,
        'list': `[1, 2, 3]`,
        'vector': `{1, 2, 3}`,
        'map': `{"key": "value"}`,
        'dictionary': `{"key": "value"}`
      };

      return examples[type] || 'null';
    },

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
    onLanguageChange() {
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω –∫–æ–¥–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π
      this.updateCodeTemplate();

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω main
      this.updateMainTemplate();
    },

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –∫–æ–¥–∞
    updateCodeTemplate() {
      if (!this.taskData.language) return;

      const language = this.availableLanguages.find(lang => lang.id === this.taskData.language);
      if (!language) return;

      const functionSignature = this.generateLanguageSpecificSignature();

      if (language.patternFunction) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —à–∞–±–ª–æ–Ω –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        this.taskData.codeTemplate = language.patternFunction.replace('{{function_signature}}', functionSignature);
      } else {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω
        this.taskData.codeTemplate = `${functionSignature} {\n    // –≤–∞—à –∫–æ–¥ –∑–¥–µ—Å—å\n}`;
      }
    },

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ main
    updateMainTemplate() {
      this.taskData.mainTemplate = this.generateMainTemplate();
    },
  },
  watch: {
    'taskData.language': {
      handler(newLanguageId) {
        if (newLanguageId) {
          console.log('Language changed to:', newLanguageId);
          this.loadLibrariesForLanguage(newLanguageId);
          // –û—á–∏—â–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞
          this.taskData.libraries = [];

          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω—ã
          this.$nextTick(() => {
            this.updateCodeTemplate();
            this.updateMainTemplate();
          });
        } else {
          this.availableLibraries = [];
        }
      },
      immediate: true
    },

    // –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω—ã
    'taskData.functionName': function() {
      if (this.taskData.language) {
        this.$nextTick(() => {
          this.updateCodeTemplate();
          this.updateMainTemplate();
        });
      }
    },

    'taskData.parameters': {
      handler() {
        if (this.taskData.language) {
          this.$nextTick(() => {
            this.updateCodeTemplate();
            this.updateMainTemplate();
          });
        }
      },
      deep: true
    },

    'taskData.returnType': function() {
      if (this.taskData.language) {
        this.$nextTick(() => {
          this.updateCodeTemplate();
          this.updateMainTemplate();
        });
      }
    }

  },
  metaInfo: {
    title: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞–¥–∞—á',
    meta: [
      {
        property: 'og:title',
        content: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞–¥–∞—á',
      },
    ],
  },
}
</script>

<style scoped>

.task-template-builder-container10 {
  width: 100%;
  display: block;
  min-height: 100vh;
  font-family: var(--font-family-body);
  background: var(--color-surface);
}

.task-template-builder-container11 {
  display: none;
}

.task-template-builder-container12 {
  display: contents;
}

.container {
  max-width: var(--content-max-width);
  margin: 0 auto;
  padding: 0 var(--spacing-lg);

}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.builder-header {
  margin-bottom: var(--spacing-2xl);
}

.title-section {
  text-align: center;
  margin-bottom: var(--spacing-xl);
}

.builder-title {
  color: var(--color-on-surface);
  font-size: var(--font-size-hero);
  margin-bottom: var(--spacing-md);
  font-family: var(--font-family-heading);
  font-weight: var(--font-weight-heading);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-md);
  line-height: var(--line-height-heading);
}

.title-icon {
  font-size: var(--font-size-xl);
}

.builder-subtitle {
  color: var(--color-on-surface-secondary);
  font-size: var(--font-size-lg);
  margin-bottom: var(--spacing-xl);
  line-height: var(--line-height-body);
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

/* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
.wizard-progress {
  padding: var(--spacing-lg);
}

.progress-bar {
  height: 8px;
  background: var(--color-backplate);
  border-radius: var(--border-radius-full);
  overflow: hidden;
  margin-bottom: var(--spacing-md);
  border: 1px solid var(--color-border);
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
  transition: width var(--animation-duration-slow) var(--animation-curve-primary);
  border-radius: var(--border-radius-full);
}

.steps-indicator {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: var(--font-size-sm);
}

.step-counter {
  color: var(--color-on-surface-secondary);
  font-weight: var(--font-weight-body);
}

.step-name {
  color: var(--color-on-surface);
  font-weight: var(--font-weight-heading);
  background: var(--color-primary);
  padding: var(--spacing-xs) var(--spacing-md);
  border-radius: var(--border-radius-full);
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –ª–µ–π–∞—É—Ç */
.wizard-layout {
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: var(--spacing-xl);
  align-items: start;
  margin-bottom: var(--spacing-2xl);
}

.wizard-sidebar {
  position: sticky;
  top: var(--spacing-xl);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
}

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —à–∞–≥–∞–º */
.steps-nav {
  padding: var(--spacing-lg);
}

.step-nav-item {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  border-radius: var(--border-radius-md);
  cursor: pointer;
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
  margin-bottom: var(--spacing-sm);
  border: 1px solid transparent;
}

.step-nav-item:last-child {
  margin-bottom: 0;
}

.step-nav-item:hover {
  background: var(--color-backplate);
  border-color: var(--color-border);
  transform: translateX(var(--spacing-xs));
}

.step-nav-item.active {
  background: color-mix(in srgb, var(--color-primary) 12%, transparent);
  border-color: var(--color-primary);
  border-left: 4px solid var(--color-primary);
}

.step-nav-item.completed {
  background: color-mix(in srgb, var(--color-accent) 8%, transparent);
  border-color: var(--color-accent);
}

.step-nav-icon {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--color-border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: var(--font-weight-heading);
  flex-shrink: 0;
  font-size: var(--font-size-sm);
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
  border: 2px solid transparent;
}

.step-nav-item.active .step-nav-icon {
  background: var(--color-primary);
  color: var(--color-on-primary);
  border-color: var(--color-primary);
}

.step-nav-item.completed .step-nav-icon {
  background: var(--color-accent);
  color: var(--color-on-surface);
  border-color: var(--color-accent);
}

.step-nav-content h3 {
  margin: 0 0 var(--spacing-xs) 0;
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-heading);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
}

.step-nav-content p {
  margin: 0;
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  line-height: var(--line-height-body);
}

/* –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.quick-preview,
.stats-preview {
  padding: var(--spacing-lg);
}

.quick-preview h4,
.stats-preview h4 {
  margin: 0 0 var(--spacing-md) 0;
  font-size: var(--font-size-base);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.preview-icon {
  font-size: var(--font-size-base);
}

.preview-badges {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.preview-badge {
  background: var(--color-backplate);
  padding: var(--spacing-sm);
  border-radius: var(--border-radius-md);
  font-size: var(--font-size-sm);
  border-left: 3px solid var(--color-primary);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
}

.preview-badge:hover {
  transform: translateX(var(--spacing-xs));
  box-shadow: var(--shadow-level-1);
}

.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
}

.stat-item {
  text-align: center;
  padding: var(--spacing-md);
  background: var(--color-backplate);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--color-border);
}

.stat-value {
  display: block;
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-heading);
  color: var(--color-primary);
  margin-bottom: var(--spacing-xs);
  font-family: var(--font-family-heading);
}

.stat-label {
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  text-transform: lowercase;
}

/* –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
.wizard-main {
  background: var(--color-surface-elevated);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-level-2);
  overflow: hidden;
  border: 1px solid var(--color-border);
}

.step-content {
  padding: var(--spacing-2xl);
  min-height: 600px;
}

.step-header {
  margin-bottom: var(--spacing-2xl);
  padding-bottom: var(--spacing-lg);
  border-bottom: 2px solid var(--color-border);
}

.step-header h2 {
  margin: 0 0 var(--spacing-md) 0;
  font-size: var(--font-size-xl);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.step-icon {
  font-size: var(--font-size-lg);
}

.step-header p {
  margin: 0;
  color: var(--color-on-surface-secondary);
  font-size: var(--font-size-base);
  line-height: var(--line-height-body);
}

/* –°–µ—Ç–∫–∞ —Ñ–æ—Ä–º */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-xl);
  margin-bottom: var(--spacing-xl);
}

.form-section {
  padding: var(--spacing-lg);
}

.form-section h3 {
  margin: 0 0 var(--spacing-lg) 0;
  font-size: var(--font-size-lg);
  color: var(--color-on-surface);
  font-family: var(--font-family-heading);
  padding-bottom: var(--spacing-sm);
  border-bottom: 2px solid var(--color-primary);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

/* –ì—Ä—É–ø–ø—ã —Ñ–æ—Ä–º */
.form-group {
  margin-bottom: var(--spacing-lg);
}

.form-group label {
  display: block;
  margin-bottom: var(--spacing-sm);
  font-weight: var(--font-weight-heading);
  color: var(--color-on-surface);
  font-family: var(--font-family-body);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.label-icon {
  font-size: var(--font-size-base);
}

.form-group label.required::after {
  content: " *";
  color: var(--color-accent);
}

.input-container {
  padding: var(--spacing-xs);
}

.vintage-border {
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  background: var(--color-surface);
  box-shadow:
      inset 0 1px 2px color-mix(in srgb, var(--color-on-surface) 3%, transparent),
      0 2px 4px color-mix(in srgb, var(--color-neutral) 5%, transparent);
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
}

.vintage-border:focus-within {
  border-color: var(--color-primary);
  box-shadow:
      inset 0 1px 2px color-mix(in srgb, var(--color-on-surface) 3%, transparent),
      0 2px 8px color-mix(in srgb, var(--color-primary) 15%, transparent);
}

.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: var(--spacing-md);
  border: none;
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-base);
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
  font-family: var(--font-family-body);
  background: transparent;
  color: var(--color-on-surface);
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  outline: none;
}

.form-group textarea {
  resize: vertical;
  min-height: 120px;
}

.form-group input.error {
  background: color-mix(in srgb, var(--color-accent) 10%, transparent);
}

.char-counter {
  text-align: right;
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  margin-top: var(--spacing-xs);
  font-style: italic;
}

.hint {
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  margin-top: var(--spacing-xs);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-style: italic;
}

.hint-icon {
  font-size: var(--font-size-sm);
}

.hint code {
  background: var(--color-backplate);
  padding: 2px 6px;
  border-radius: var(--border-radius-sm);
  font-family: monospace;
  font-size: var(--font-size-sm);
}

/* –ö–Ω–æ–ø–∫–∏ */

.btn-outline_left {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-lg);
  border: 2px solid;
  border-radius: var(--border-radius-md);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-heading);
  text-decoration: none;
  cursor: pointer;
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
  font-family: var(--font-family-body);
}
.btn-outline {
  background: transparent;
  border-color: var(--color-border);
  color: var(--color-on-surface);
}

.btn-outline:hover:not(:disabled) {
  border-color: var(--color-primary);
  color: var(--color-primary);
}
/* –ö–Ω–æ–ø–∫–∞ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞—á—É - –†–µ—Ç—Ä–æ —Å—Ç–∏–ª—å */
.wizard-navigation .btn-accent {
  color: var(--color-on-surface);
  border: 2px solid var(--color-accent);
  background: var(--color-accent);
  box-shadow:
      3px 3px 0 color-mix(in srgb, var(--color-secondary) 70%, transparent),
      var(--shadow-level-1);
  position: relative;
  font-weight: 600;
  font-family: var(--font-family-heading);
  letter-spacing: 0.5px;
  padding: var(--spacing-md) var(--spacing-2xl);
  transition: all 0.2s ease;
  text-transform: uppercase;
  font-size: var(--font-size-sm);
}

/* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è */
.wizard-navigation .btn-accent:hover:not(:disabled) {
  transform: translate(1px, 1px);
  box-shadow:
      2px 2px 0 color-mix(in srgb, var(--color-secondary) 70%, transparent),
      var(--shadow-level-1);
  background: color-mix(in srgb, var(--color-accent) 85%, black);
}

/* –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.wizard-navigation .btn-accent:active:not(:disabled) {
  transform: translate(3px, 3px);
  box-shadow:
      0px 0px 0 color-mix(in srgb, var(--color-secondary) 70%, transparent),
      var(--shadow-level-1);
}

/* –ò–∫–æ–Ω–∫–∞ –¥–∏—Å–∫–µ—Ç—ã */
.wizard-navigation .btn-accent .btn-icon {
  font-size: var(--font-size-base);
  margin-right: var(--spacing-xs);
  transition: transform 0.2s ease;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –∏–∫–æ–Ω–∫–∏ */
.wizard-navigation .btn-accent:hover:not(:disabled) .btn-icon {
  transform: scale(1.1);
}

/* –§–æ–∫—É—Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.wizard-navigation .btn-accent:focus-visible {
  outline: 2px dashed var(--color-outline);
  outline-offset: 2px;
}

/* Disabled —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.wizard-navigation .btn-accent:disabled {
  color: color-mix(in srgb, var(--color-on-surface) 50%, transparent);
  border: 2px solid color-mix(in srgb, var(--color-accent) 40%, transparent);
  background: color-mix(in srgb, var(--color-accent) 20%, transparent);
  box-shadow:
      2px 2px 0 color-mix(in srgb, var(--color-secondary) 20%, transparent),
      var(--shadow-level-1);
  transform: none;
  cursor: not-allowed;
}

/* –¢–æ—á–∫–∏ –ø–æ —É–≥–ª–∞–º –≤ —Ä–µ—Ç—Ä–æ-—Å—Ç–∏–ª–µ */
.wizard-navigation .btn-accent::before,
.wizard-navigation .btn-accent::after {
  content: '';
  position: absolute;
  width: 6px;
  height: 6px;
  background: var(--color-secondary);
  border-radius: 50%;
}

.wizard-navigation .btn-accent::before {
  top: -2px;
  left: -2px;
}

.wizard-navigation .btn-accent::after {
  bottom: -2px;
  right: -2px;
}

/* –ü–æ–ª–æ—Å–∫–∏ –ø–æ –±–æ–∫–∞–º */
.wizard-navigation .btn-accent {
  border-left: 4px solid color-mix(in srgb, var(--color-secondary) 60%, transparent);
  border-right: 4px solid color-mix(in srgb, var(--color-secondary) 60%, transparent);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .wizard-navigation .btn-accent {
    padding: var(--spacing-lg) var(--spacing-xl);
    font-size: var(--font-size-base);
  }
}
/* –ö–Ω–æ–ø–∫–∞ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å - –†–µ—Ç—Ä–æ —Å—Ç–∏–ª—å */
.wizard-navigation .btn-primary {
  color: var(--color-on-primary);
  border: 3px double var(--color-primary);
  background: var(--color-primary);
  box-shadow:
      4px 4px 0 color-mix(in srgb, var(--color-secondary) 80%, transparent),
      var(--shadow-level-1);
  position: relative;
  font-weight: 600;
  font-family: var(--font-family-heading);
  letter-spacing: 0.5px;
  padding: var(--spacing-md) var(--spacing-2xl);
  transition: all 0.2s ease;
  text-transform: uppercase;
  font-size: var(--font-size-sm);
}

/* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–∏ */
.wizard-navigation .btn-primary:hover:not(:disabled) {
  transform: translate(2px, 2px);
  box-shadow:
      2px 2px 0 color-mix(in srgb, var(--color-secondary) 80%, transparent),
      var(--shadow-level-1);
  background: color-mix(in srgb, var(--color-primary) 90%, black);
}

/* –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.wizard-navigation .btn-primary:active:not(:disabled) {
  transform: translate(4px, 4px);
  box-shadow:
      0px 0px 0 color-mix(in srgb, var(--color-secondary) 80%, transparent),
      var(--shadow-level-1);
}

/* –ò–∫–æ–Ω–∫–∞ —Å—Ç—Ä–µ–ª–∫–∏ */
.wizard-navigation .btn-primary .btn-icon {
  font-size: var(--font-size-base);
  margin-left: var(--spacing-xs);
  transition: transform 0.2s ease;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∏ */
.wizard-navigation .btn-primary:hover:not(:disabled) .btn-icon {
  transform: translateX(2px);
}

/* –§–æ–∫—É—Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.wizard-navigation .btn-primary:focus-visible {
  outline: 2px dashed var(--color-outline);
  outline-offset: 2px;
}

/* Disabled —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.wizard-navigation .btn-primary:disabled {
  color: color-mix(in srgb, var(--color-on-primary) 60%, transparent);
  border: 3px double color-mix(in srgb, var(--color-primary) 50%, transparent);
  background: color-mix(in srgb, var(--color-primary) 30%, transparent);
  box-shadow:
      2px 2px 0 color-mix(in srgb, var(--color-secondary) 30%, transparent),
      var(--shadow-level-1);
  transform: none;
  cursor: not-allowed;
}

/* –†–µ—Ç—Ä–æ —Ç–µ–∫—Å—Ç—É—Ä–∞ */
.wizard-navigation .btn-primary {
  background-image:
      repeating-linear-gradient(
          45deg,
          transparent,
          transparent 2px,
          color-mix(in srgb, var(--color-on-primary) 5%, transparent) 2px,
          color-mix(in srgb, var(--color-on-primary) 5%, transparent) 4px
      );
}

/* –£–≥–ª–æ–≤—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã */
.wizard-navigation .btn-primary::before,
.wizard-navigation .btn-primary::after {
  content: '';
  position: absolute;
  width: 8px;
  height: 8px;
  background: var(--color-secondary);
}

.wizard-navigation .btn-primary::before {
  top: -3px;
  left: -3px;
  clip-path: polygon(0 0, 100% 0, 0 100%);
}

.wizard-navigation .btn-primary::after {
  bottom: -3px;
  right: -3px;
  clip-path: polygon(100% 0, 100% 100%, 0 100%);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .wizard-navigation .btn-primary {
    padding: var(--spacing-lg) var(--spacing-xl);
    font-size: var(--font-size-base);
  }
}

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
.wizard-navigation {
  padding: var(--spacing-lg);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--color-backplate);
  border-top: 1px solid var(--color-border);
}

.nav-left,
.nav-center,
.nav-right {
  flex: 1;
  display: flex;
  align-items: center;
}

.nav-center {
  justify-content: center;
}

.nav-right {
  justify-content: flex-end;
  gap: var(--spacing-md);
}

.step-info {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  background: var(--color-surface);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--border-radius-full);
  border: 1px solid var(--color-border);
}

.step-current {
  font-weight: var(--font-weight-heading);
  color: var(--color-primary);
  font-size: var(--font-size-lg);
}

.step-separator {
  color: var(--color-on-surface-secondary);
}

.step-total {
  color: var(--color-on-surface-secondary);
}

/* –ü—Ä–∏–º–µ—Ä —Å–µ–∫—Ü–∏–∏ */
.example-section {
  padding: var(--spacing-lg);
  margin-top: var(--spacing-xl);
}

.example-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-lg);
}

.example-bad,
.example-good {
  padding: var(--spacing-md);
  border-radius: var(--border-radius-md);
}

.example-bad {
  background: color-mix(in srgb, var(--color-accent) 8%, transparent);
  border: 1px dashed var(--color-accent);
}

.example-good {
  background: color-mix(in srgb, var(--color-primary) 8%, transparent);
  border: 1px dashed var(--color-primary);
}

.example-bad h4,
.example-good h4 {
  margin: 0 0 var(--spacing-sm) 0;
  font-size: var(--font-size-base);
  font-family: var(--font-family-heading);
}

.example-bad p,
.example-good p {
  margin: 0;
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  line-height: var(--line-height-body);
}

.example-good code {
  background: var(--color-backplate);
  padding: 2px 6px;
  border-radius: var(--border-radius-sm);
  font-family: monospace;
  font-size: var(--font-size-sm);
}

/* –ü–∞—Ä–∞–º–µ—Ç—Ä—ã */
.params-container {
  padding: var(--spacing-md);
}

.params-header {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 2fr 40px;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  background: var(--color-backplate);
  border-radius: var(--border-radius-sm);
  margin-bottom: var(--spacing-sm);
  font-weight: var(--font-weight-heading);
  font-size: var(--font-size-sm);
}

.param-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 2fr 40px;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-sm);
  align-items: center;
}

/* –£—Å–ª–æ–≤–∏—è */
.conditions-list {
  padding: var(--spacing-md);
}

.condition-item {
  display: flex;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-sm);
  align-items: center;
}

.condition-item input {
  flex: 1;
}

/* –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä */
.preview-section {
  margin-top: var(--spacing-xl);
  padding-top: var(--spacing-lg);
  border-top: 1px solid var(--color-border);
}

.code-preview {
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
}

.code-preview pre {
  margin: 0;
  font-family: monospace;
  font-size: var(--font-size-sm);
  line-height: var(--line-height-body);
  color: var(--color-on-surface);
}

/* –Ø–∑—ã–∫–∏ */
.languages-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-md);
}

.language-option {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  cursor: pointer;
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
}

.language-option:hover {
  border-color: var(--color-primary);
}

.language-option.selected {
  border-color: var(--color-primary);
  background: color-mix(in srgb, var(--color-primary) 8%, transparent);
}

.lang-icon {
  font-size: var(--font-size-xl);
}

.lang-info {
  display: flex;
  flex-direction: column;
}

.lang-info strong {
  font-size: var(--font-size-base);
  font-family: var(--font-family-heading);
}

.lang-info span {
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
}

/* –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ */
.libraries-panel {
  padding: var(--spacing-md);
}

.libraries-search {
  padding: var(--spacing-md);
  border-bottom: 1px solid var(--color-border);
  background: var(--color-backplate);
}

.libraries-search input {
  width: 100%;
}

.libraries-list {
  max-height: 300px;
  overflow-y: auto;
}

.library-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  border-bottom: 1px solid var(--color-border);
  cursor: pointer;
  transition: background var(--animation-duration-standard) var(--animation-curve-primary);
}

.library-item:last-child {
  border-bottom: none;
}

.library-item:hover {
  background: var(--color-backplate);
}

.library-item.selected {
  background: color-mix(in srgb, var(--color-primary) 8%, transparent);
}

.lib-info strong {
  display: block;
  margin-bottom: var(--spacing-xs);
  font-family: var(--font-family-heading);
}

.lib-description {
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
  margin: var(--spacing-xs) 0 0 0;
}

.lib-compatibility {
  font-size: var(--font-size-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--border-radius-full);
  font-weight: var(--font-weight-heading);
}

.lib-compatibility.full {
  background: color-mix(in srgb, var(--color-primary) 15%, transparent);
  color: var(--color-primary);
}

.lib-compatibility.limited {
  background: color-mix(in srgb, var(--color-accent) 15%, transparent);
  color: var(--color-accent);
}

.selected-libraries {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-sm);
}

.selected-library {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  background: var(--color-primary);
  color: var(--color-on-primary);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--border-radius-full);
  font-size: var(--font-size-sm);
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è */
.execution-settings {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-lg);
}

/* –ü—Ä–∏–º–µ—Ä—ã */
.examples-container {
  padding: var(--spacing-md);
}

.example-item {
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-md);
}

.example-item:last-child {
  margin-bottom: 0;
}

.example-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-md);
  padding-bottom: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
}

.example-header h4 {
  margin: 0;
  font-family: var(--font-family-heading);
}

.example-content {
  display: grid;
  gap: var(--spacing-md);
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  font-weight: normal;
  cursor: pointer;
}

/* –¢–µ—Å—Ç—ã */
.tests-management {
  margin-bottom: var(--spacing-xl);
}

.tests-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-lg);
}

.tests-actions {
  display: flex;
  gap: var(--spacing-sm);
}

.tests-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
}

.test-case {
  padding: var(--spacing-lg);
  border: 2px solid transparent;
}

.test-case.public {
  border-color: color-mix(in srgb, var(--color-primary) 30%, transparent);
}

.test-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--spacing-md);
}

.test-info h4 {
  margin: 0 0 var(--spacing-xs) 0;
  font-family: var(--font-family-heading);
}

.test-meta {
  display: flex;
  gap: var(--spacing-md);
  font-size: var(--font-size-sm);
  color: var(--color-on-surface-secondary);
}

.test-visibility {
  font-weight: var(--font-weight-heading);
}

.test-weight {
  font-weight: var(--font-weight-heading);
}

.test-actions {
  display: flex;
  gap: var(--spacing-sm);
}

.test-content {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: var(--spacing-lg);
}

.test-io {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
}

.io-section label {
  display: block;
  margin-bottom: var(--spacing-sm);
  font-weight: var(--font-weight-heading);
}

.io-section textarea {
  width: 100%;
  min-height: 100px;
  resize: vertical;
}

.test-settings {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
.testing-settings {
  padding: var(--spacing-lg);
}

.testing-settings h3 {
  margin: 0 0 var(--spacing-lg) 0;
  font-family: var(--font-family-heading);
}

.settings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--spacing-md);
}

/* –¢–µ–≥–∏ */
.tags-input {
  padding: var(--spacing-sm);
}

.tags-list {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-xs);
  margin-bottom: var(--spacing-sm);
}

.tag {
  display: inline-flex;
  align-items: center;
  background: var(--color-secondary);
  color: var(--color-on-surface);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--border-radius-full);
  font-size: var(--font-size-sm);
  gap: var(--spacing-xs);
}

.tag-remove {
  background: none;
  border: none;
  color: inherit;
  cursor: pointer;
  font-size: var(--font-size-base);
  line-height: 1;
  padding: 0;
  width: 16px;
  height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ */
.difficulty-selector {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--spacing-sm);
}

.difficulty-option {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--spacing-md) var(--spacing-sm);
  cursor: pointer;
  transition: all var(--animation-duration-standard) var(--animation-curve-primary);
  text-align: center;
}

.difficulty-option:hover {
  border-color: var(--color-primary);
}

.difficulty-option.selected {
  border-color: var(--color-primary);
  background: color-mix(in srgb, var(--color-primary) 8%, transparent);
}

.diff-icon {
  font-size: var(--font-size-xl);
  margin-bottom: var(--spacing-xs);
}

.diff-label {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-heading);
}

/* –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è */
.time-estimate {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
}

.time-estimate input {
  width: 80px;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1200px) {
  .wizard-layout {
    grid-template-columns: 280px 1fr;
    gap: var(--spacing-lg);
  }
}

@media (max-width: 1024px) {
  .wizard-layout {
    grid-template-columns: 1fr;
  }

  .wizard-sidebar {
    position: static;
    order: 2;
  }

  .form-grid {
    grid-template-columns: 1fr;
  }

  .test-content {
    grid-template-columns: 1fr;
  }

  .test-io {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .container {
    padding: 0 var(--spacing-md);
  }

  .step-content {
    padding: var(--spacing-lg);
  }

  .builder-title {
    font-size: var(--font-size-xl);
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .wizard-navigation {
    flex-direction: column;
    gap: var(--spacing-lg);
    text-align: center;
  }

  .nav-left,
  .nav-center,
  .nav-right {
    justify-content: center;
    width: 100%;
  }

  .nav-right {
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .difficulty-selector {
    grid-template-columns: 1fr 1fr;
  }

  .languages-grid {
    grid-template-columns: 1fr;
  }

  .params-header,
  .param-row {
    grid-template-columns: 1fr;
    gap: var(--spacing-xs);
  }
}

@media (max-width: 480px) {
  .tests-header {
    flex-direction: column;
    gap: var(--spacing-md);
    align-items: stretch;
  }

  .tests-actions {
    justify-content: center;
  }

  .test-header {
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .test-actions {
    justify-content: flex-start;
  }

  .example-content {
    grid-template-columns: 1fr;
  }
}
</style>